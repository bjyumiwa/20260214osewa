<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>3æ—¥é–“ã®ãŠä¸–è©±ã‚²ãƒ¼ãƒ ï¼ˆ2Dï¼‰</title>
  <style>
    :root{
      --bg0:#050816;
      --bg1:#0b1028;
      --card:rgba(255,255,255,.08);
      --text:#eef2ff;
      --muted:rgba(238,242,255,.72);
      --line:rgba(255,255,255,.14);
      --shadow: 0 14px 40px rgba(0,0,0,.35);
      --radius: 18px;
    }
    *{box-sizing:border-box;}
    body{
      margin:0;
      color:var(--text);
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", "Hiragino Kaku Gothic ProN", "Yu Gothic", sans-serif;
      background:
        linear-gradient(180deg, rgba(5,8,22,.55), rgba(11,16,40,.70)),
        url("public/char/space_background.png") center/cover no-repeat fixed;
      min-height:100vh;
      overflow-x:hidden;
    }

    .wrap{max-width: 1100px; margin:0 auto; padding: 18px 14px 40px;}
    .topbar{
      display:flex; gap:12px; align-items:center; justify-content:space-between;
      padding: 10px 12px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.05);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      position: sticky; top: 10px;
      backdrop-filter: blur(10px);
      z-index: 20;
      flex-wrap: wrap;
    }
    .brand{display:flex; gap:10px; align-items:center;}
    .brand .dot{
      width:12px;height:12px;border-radius:999px;
      background: radial-gradient(circle at 30% 30%, #fff, rgba(255,255,255,.1)),
                  linear-gradient(180deg, #c4b5fd, #93c5fd);
      box-shadow: 0 0 18px rgba(196,181,253,.35);
    }
    .brand .title{font-weight: 750; letter-spacing:.02em; font-size: 14px; line-height: 1.2;}
    .brand .sub{font-size: 12px; color: var(--muted); margin-top: 2px;}
    .statusRow{display:flex; gap: 10px; align-items:center; justify-content:flex-end; flex: 1; flex-wrap: wrap;}
    .pill{
      display:flex; align-items:center; gap:8px;
      padding: 8px 10px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.05);
      border-radius: 999px;
      min-height: 34px;
      position: relative;
    }
    .pill small{color: var(--muted);}

    .heartIcon{
      width:16px;height:16px; display:inline-block;
      background: radial-gradient(circle at 30% 30%, #fff, rgba(255,255,255,.1)),
                  linear-gradient(180deg, rgba(251,113,133,.95), rgba(196,181,253,.85));
      clip-path: path("M8 14s6-3.3 6-7.2C14 4.6 12.8 3 10.8 3 9.6 3 8.7 3.7 8 4.6 7.3 3.7 6.4 3 5.2 3 3.2 3 2 4.6 2 6.8 2 10.7 8 14 8 14Z");
      opacity:.95;
    }
    .hearts{
      width: 140px; height: 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.08);
      overflow:hidden;
    }
    .hearts > i{
      display:block; height:100%; width:50%;
      background: linear-gradient(90deg, rgba(196,181,253,.95), rgba(147,197,253,.95));
      box-shadow: 0 0 14px rgba(147,197,253,.25);
    }

    .langSel{
      appearance:none;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      color: rgba(238,242,255,.92);
      border-radius: 12px;
      padding: 8px 28px 8px 10px;
      font-weight: 700;
      cursor: pointer;
      outline: none;
      line-height: 1;
    }
    .langSel option{background:#0b1028; color:#eef2ff;}
    .pill[title="Language"]::after{
      content:"â–¾";
      position:absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      color: rgba(238,242,255,.72);
      pointer-events:none;
      font-size: 12px;
    }

    .toggle{display:flex; align-items:center; gap:8px; cursor:pointer; user-select:none;}
    .switch{
      width:42px;height:24px;border-radius:999px;
      border: 1px solid rgba(255,255,255,.22);
      background: rgba(255,255,255,.08);
      position: relative;
      transition: .18s ease;
    }
    .switch::after{
      content:"";
      width:18px;height:18px;border-radius:999px;
      position:absolute; top:2px; left:2px;
      background: rgba(255,255,255,.85);
      box-shadow: 0 8px 14px rgba(0,0,0,.25);
      transition: .18s ease;
    }
    .toggle[data-on="true"] .switch{
      background: rgba(154,230,180,.18);
      border-color: rgba(154,230,180,.28);
    }
    .toggle[data-on="true"] .switch::after{
      left: 20px;
      background: rgba(154,230,180,.95);
    }

    .main{margin-top: 14px; display:grid; grid-template-columns: 1.5fr 1fr; gap: 14px; align-items:start;}
    .card{
      border: 1px solid var(--line);
      background: rgba(255,255,255,.05);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .cardHeader{
      padding: 12px 12px 10px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      display:flex; align-items:center; justify-content:space-between; gap: 10px;
      flex-wrap: wrap;
    }
    .cardHeader .h{font-weight: 800; font-size: 14px;}
    .cardHeader .hint{font-size:12px;color:var(--muted); margin-top: 2px;}
    .btnRow{display:flex; gap: 10px; flex-wrap: wrap;}

    button{
      appearance:none;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      color: var(--text);
      border-radius: 14px;
      padding: 12px 10px;
      cursor:pointer;
      font-weight: 650;
      letter-spacing:.01em;
      box-shadow: 0 12px 26px rgba(0,0,0,.22);
      transition: transform .08s ease, background .18s ease, border-color .18s ease, opacity .18s ease;
    }
    button:hover{transform: translateY(-1px); background: rgba(255,255,255,.09); border-color: rgba(255,255,255,.22);}
    button:active{transform: translateY(0px) scale(.99);}
    button[disabled]{opacity:.45; cursor:not-allowed; transform:none;}
    .btnGhost{background: rgba(255,255,255,.03); padding: 10px 10px;}
    .grid{display:grid; grid-template-columns: 1fr 1fr; gap: 10px;}

    .stage{
      position: relative;
      min-height: 520px;
      padding: 14px;
    }
    .sky{position:absolute; inset:0; pointer-events:none;
      background:
        radial-gradient(1200px 700px at 60% 10%, rgba(196,181,253,.10), transparent 60%),
        radial-gradient(900px 600px at 15% 80%, rgba(147,197,253,.10), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.03), rgba(0,0,0,0));
    }
    .stars{
      position:absolute; inset:0; pointer-events:none; opacity:.55;
      background-image:
        radial-gradient(circle at 10% 20%, rgba(255,255,255,.8) 0 1px, transparent 2px),
        radial-gradient(circle at 40% 70%, rgba(255,255,255,.7) 0 1px, transparent 2px),
        radial-gradient(circle at 70% 30%, rgba(255,255,255,.7) 0 1px, transparent 2px),
        radial-gradient(circle at 85% 75%, rgba(255,255,255,.7) 0 1px, transparent 2px),
        radial-gradient(circle at 25% 50%, rgba(255,255,255,.55) 0 1px, transparent 2px);
      background-size: 420px 260px;
      filter: blur(.2px);
      animation: drift 18s linear infinite;
    }
    @keyframes drift{
      0%{transform: translate3d(0,0,0);}
      100%{transform: translate3d(-80px, 50px, 0);}
    }
    .center{
      position:absolute;
      left:50%;
      top: 55%;
      transform: translate(-50%,-50%);
      width: 100%;
      max-width: 560px;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap: 12px;
      padding: 12px;
    }
    .entity{
      width: 280px;
      height: 280px;
      display:grid;
      place-items:center;
      position: relative;
    }
    .floaty{animation: floaty 2.6s ease-in-out infinite;}
    @keyframes floaty{
      0%,100%{transform: translateY(0);}
      50%{transform: translateY(-10px);}
    }

    .macaronWrap{width: 260px; height: 260px; display:grid; place-items:center; position: relative;}
    .macaronImg{
      width: 210px; height: 210px; object-fit: contain;
      filter: drop-shadow(0 18px 26px rgba(0,0,0,.35));
      opacity: .98;
    }
    .hatchLift{animation: hatchLift 1.6s ease-in-out 1 forwards;}
    @keyframes hatchLift{
      0%{transform: translateY(0) scale(1); opacity: 1;}
      60%{transform: translateY(-26px) scale(1.02); opacity: 1;}
      100%{transform: translateY(-60px) scale(.95); opacity: 0;}
    }

    .charWrap{
      width: 260px; height: 260px;
      display:grid; place-items:center;
      position: relative;
      filter: drop-shadow(0 18px 26px rgba(0,0,0,.35));
    }
    .charImg{width: 230px; height: 230px; object-fit: contain; opacity: .98; transition: .18s ease;}
    .charWrap.lively{animation: livelyBounce 1.4s ease-in-out infinite;}
    @keyframes livelyBounce{
      0%,100%{transform: translateY(0) rotate(0deg);}
      50%{transform: translateY(-7px) rotate(.6deg);}
    }
    .charWrap.low .charImg{filter: saturate(.75) brightness(.95); transform: translateY(2px);}
    .charWrap.cry .charImg{filter: saturate(.65) brightness(.9); animation: cryShake .18s steps(2) infinite;}
    @keyframes cryShake{
      0%{transform: translate(0,0);}
      50%{transform: translate(2px,-1px);}
      100%{transform: translate(-1px,1px);}
    }

    .charWrap.sleep{animation: sleepBreath 2.8s ease-in-out infinite;}
    .charWrap.sleep .charImg{filter: saturate(.9) brightness(.96); transform: translateY(3px);}
    @keyframes sleepBreath{
      0%,100%{transform: translateY(2px);}
      50%{transform: translateY(-4px);}
    }

    .tears{position:absolute; inset:0; pointer-events:none; opacity:0; transition:.18s ease;}
    .charWrap.cry .tears{opacity:1;}
    .tear{
      position:absolute;
      width: 10px; height: 18px;
      border-radius: 999px;
      background: rgba(147,197,253,.72);
      left: 92px; top: 130px;
      transform: rotate(10deg);
      animation: tearDrop 1.2s ease-in-out infinite;
      filter: blur(.1px);
    }
    .tear:nth-child(2){
      left: 150px; top: 132px;
      transform: rotate(-8deg);
      animation-delay: .22s;
      opacity:.9;
    }
    @keyframes tearDrop{
      0%{transform: translateY(0) scale(1) rotate(10deg); opacity:.0;}
      35%{opacity:.75;}
      100%{transform: translateY(26px) scale(.95) rotate(10deg); opacity:0;}
    }

    .poops{
      position:absolute;
      left: 18px;
      bottom: 18px;
      display:flex;
      gap: 8px;
      align-items:center;
      opacity:.95;
    }
    .poop{
      width: 18px; height: 18px;
      border-radius: 6px;
      background: linear-gradient(180deg, rgba(251,146,60,.92), rgba(234,179,8,.82));
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: 0 10px 16px rgba(0,0,0,.25);
      transform: rotate(-8deg);
      opacity:.0;
      transition: .18s ease;
    }
    .poop.on{opacity:.95;}
    .poop:nth-child(2){transform: rotate(9deg) translateY(-2px);}
    .poop:nth-child(3){transform: rotate(-4deg) translateY(1px);}

    .stageNote{
      margin-top: 8px;
      font-size: 12px;
      color: var(--muted);
      text-align:center;
      opacity:.95;
      line-height: 1.6;
      white-space: pre-wrap;
      min-height: 42px;
    }

    .rightPane{display:flex; flex-direction:column; gap: 14px;}
    .actions{padding: 12px; display:flex; flex-direction:column; gap: 10px;}
    .logPane{padding: 12px;}
    .mini{font-size: 12px; color: var(--muted); line-height: 1.6;}
    .logList{margin-top: 10px; display:flex; flex-direction:column; gap: 8px; max-height: 290px; overflow:auto; padding-right: 6px;}
    .logItem{
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      border-radius: 14px;
      padding: 10px 10px;
      font-size: 12px;
      line-height: 1.5;
    }
    .logItem b{font-size:12px;}
    .logItem .t{color: var(--muted); margin-top: 2px; font-size: 11px;}

    .centerOverlay{
      position:absolute; inset:0;
      display:none; place-items:center;
      z-index: 10;
      pointer-events:none;
    }
    .centerOverlay.show{display:grid;}
    .thanks{font-weight: 900; font-size: 44px; letter-spacing: .06em; text-shadow: 0 18px 48px rgba(0,0,0,.45); opacity:.98;}

    .screen{display:none;}
    .screen.show{display:block;}

    .modalBack{
      position: fixed; inset:0;
      background: rgba(0,0,0,.55);
      display:none; place-items:center;
      z-index: 99; padding: 18px;
    }
    .modalBack.show{display:grid;}
    .modal{
      width: min(560px, 96vw);
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(16,18,34,.88);
      border-radius: 18px;
      box-shadow: 0 22px 60px rgba(0,0,0,.45);
      overflow:hidden;
      backdrop-filter: blur(12px);
    }
    .modalHead{
      padding: 12px 12px 10px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      display:flex; align-items:center; justify-content:space-between; gap: 10px;
    }
    .modalHead .h{font-weight: 850; font-size: 14px; letter-spacing:.02em;}
    .modalBody{padding: 12px;}
    .modalFoot{
      padding: 10px 12px 12px;
      border-top: 1px solid rgba(255,255,255,.10);
      display:flex; gap: 10px; justify-content:flex-end; flex-wrap: wrap;
    }
    .two{display:grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;}
    .choice{
      text-align:left;
      padding: 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
      cursor:pointer;
      transition: .18s ease;
      min-height: 96px;
      display:flex; flex-direction:column; gap: 6px; justify-content:center;
    }
    .choice:hover{background: rgba(255,255,255,.08); border-color: rgba(255,255,255,.22); transform: translateY(-1px);}
    .choice .cTitle{font-weight: 800; font-size: 13px; display:flex; align-items:center; gap: 8px;}
    .choice .cSub{font-size: 12px; color: var(--muted); line-height:1.5;}
    .cIcon{
      width: 26px; height: 26px;
      border-radius: 10px;
      display:grid; place-items:center;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: 0 10px 18px rgba(0,0,0,.18);
      font-size: 16px;
      line-height: 1;
      flex: 0 0 auto;
    }

    .observeWrap{padding: 12px;}
    .observeHeader{display:flex; gap: 10px; align-items:flex-start; justify-content:space-between; flex-wrap: wrap;}
    .observeHeader .h{font-weight: 900; font-size: 16px; letter-spacing:.02em;}
    .observeHeader .p{margin-top: 4px; font-size: 12px; color: var(--muted); line-height:1.6;}
    .chartBox{
      margin-top: 12px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      border-radius: 16px;
      padding: 10px;
    }
    canvas{width:100%; height:160px; display:block;}
    .days{margin-top: 12px; display:flex; flex-direction:column; gap: 10px;}
    .dayCard{
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      border-radius: 16px;
      padding: 10px;
    }
    .dayCard .dh{display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap; align-items:center; margin-bottom: 8px;}
    .dayCard .dh b{font-size: 13px;}
    .dayCard .dh small{color: var(--muted);}
    .kvs{display:grid; grid-template-columns: 1fr 1fr; gap: 8px 10px; font-size: 12px; color: rgba(238,242,255,.88); line-height:1.6;}
    .kvs span{color: var(--muted);}
    .choices{
      margin-top: 8px;
      border-top: 1px solid rgba(255,255,255,.10);
      padding-top: 8px;
      font-size: 12px;
      color: rgba(238,242,255,.88);
      line-height:1.7;
      white-space: pre-wrap;
    }

    .letterSlot{display:none;}
    .letterSlot.show{
      display:block;
      animation: letterAppear .9s ease-out both;
    }
    .letterSlot.vanish{
      display:block;
      animation: letterVanish .65s ease-in both;
      pointer-events:none;
    }
    @keyframes letterAppear{
      0%{opacity:0; transform: translateY(8px) scale(.98); filter: blur(10px);}
      100%{opacity:1; transform: translateY(0) scale(1); filter: blur(0);}
    }
    @keyframes letterVanish{
      0%{opacity:1; transform: translateY(0) scale(1); filter: blur(0);}
      100%{opacity:0; transform: translateY(10px) scale(.98); filter: blur(10px);}
    }
    .letterBtn{
      width:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 10px;
      padding: 12px 10px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      color: var(--text);
      cursor:pointer;
      position: relative;
      overflow: hidden;
      backdrop-filter: blur(10px);
      box-shadow: 0 12px 26px rgba(0,0,0,.22);
      animation: letterFloat 3.4s ease-in-out infinite;
    }
    @keyframes letterFloat{
      0%,100%{transform: translateY(0);}
      50%{transform: translateY(-3px);}
    }
    .letterIcon{
      font-size: 18px;
      line-height: 1;
      opacity:.95;
    }
    .letterHint{
      font-size: 12px;
      color: rgba(238,242,255,.86);
      letter-spacing: .02em;
    }
    .letterBtn::before,
    .letterBtn::after{
      content:"";
      position:absolute;
      inset:-25%;
      background:
        radial-gradient(circle at 25% 60%, rgba(255,255,255,.20), transparent 55%),
        radial-gradient(circle at 65% 40%, rgba(255,255,255,.14), transparent 58%),
        radial-gradient(circle at 40% 20%, rgba(255,255,255,.10), transparent 55%);
      filter: blur(12px);
      opacity: 0;
      transform: scale(.98);
      pointer-events:none;
    }
    .letterSlot.show .letterBtn::before{animation: smokePulse 2.6s ease-in-out infinite;}
    .letterSlot.show .letterBtn::after{animation: smokePulse 2.6s ease-in-out infinite .8s;}
    @keyframes smokePulse{
      0%{opacity:0; transform: scale(.98) translateY(8px);}
      35%{opacity:1; transform: scale(1.02) translateY(0);}
      100%{opacity:0; transform: scale(1.05) translateY(-12px);}
    }

    .letterSlot.show.drop{
      animation: letterDrop .95s ease-out both;
    }
    @keyframes letterDrop{
      0%{opacity:0; transform: translateY(-46px) scale(.98); filter: blur(10px);}
      65%{opacity:1; transform: translateY(6px) scale(1.00); filter: blur(0);}
      100%{opacity:1; transform: translateY(0) scale(1.00); filter: blur(0);}
    }

    .letterModal{
      position: fixed;
      inset: 0;
      display:none;
      place-items:center;
      padding: 18px;
      background: rgba(0,0,0,.40);
      z-index: 120;
    }
    .letterModal.open{display:grid; animation: modalIn .25s ease-out both;}
    .letterModal.closing{display:grid; animation: modalOut .22s ease-in both;}
    @keyframes modalIn{from{opacity:0;}to{opacity:1;}}
    @keyframes modalOut{from{opacity:1;}to{opacity:0;}}

    .letterPaper{
      width: min(560px, 96vw);
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(16,18,34,.88);
      box-shadow: 0 22px 60px rgba(0,0,0,.45);
      backdrop-filter: blur(12px);
      overflow:hidden;
      position: relative;
      animation: paperIn .55s ease-out both;
    }
    .letterModal.closing .letterPaper{animation: paperOut .25s ease-in both;}
    @keyframes paperIn{
      0%{opacity:0; transform: translateY(12px) scale(.98); filter: blur(14px);}
      100%{opacity:1; transform: translateY(0) scale(1); filter: blur(0);}
    }
    @keyframes paperOut{
      0%{opacity:1; transform: translateY(0) scale(1); filter: blur(0);}
      100%{opacity:0; transform: translateY(10px) scale(.98); filter: blur(12px);}
    }
    .letterPaper::before{
      content:"";
      position:absolute;
      inset:-30%;
      background:
        radial-gradient(circle at 30% 70%, rgba(255,255,255,.18), transparent 58%),
        radial-gradient(circle at 70% 35%, rgba(255,255,255,.12), transparent 62%);
      filter: blur(14px);
      opacity: .55;
      pointer-events:none;
      animation: paperSmoke 3.6s ease-in-out infinite;
    }
    @keyframes paperSmoke{
      0%,100%{transform: translateY(0); opacity: .45;}
      50%{transform: translateY(-10px); opacity: .68;}
    }
    .letterHead{
      padding: 12px 12px 10px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
    }
    .letterHead b{
      font-size: 14px;
      letter-spacing:.02em;
    }
    .letterBody{
      padding: 12px;
    }
    .letterText{
      font-size: 13px;
      line-height: 1.85;
      color: rgba(238,242,255,.92);
      white-space: pre-wrap;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
    }
    .letterFoot{
      padding: 10px 12px 12px;
      border-top: 1px solid rgba(255,255,255,.10);
      display:flex;
      justify-content:flex-end;
      gap: 10px;
    }

    @media (max-width: 860px){
      .main{grid-template-columns: 1fr;}
      .hearts{width: 120px;}
    }
    @media (prefers-reduced-motion: reduce){
      *{animation:none !important; transition:none !important;}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="dot"></div>
        <div>
          <div class="title" id="txtGameTitle">3æ—¥é–“ã®ãŠä¸–è©±ã‚²ãƒ¼ãƒ ï¼ˆ2Dï¼‰</div>
          <div class="sub" id="subline">ãƒ­ã‚°è¨˜éŒ²</div>
        </div>
      </div>

      <div class="statusRow">
        <div class="pill" title="é–¢ä¿‚æ€§ã®æŒ‡æ¨™">
          <span class="heartIcon" aria-hidden="true"></span>
          <div class="hearts" aria-hidden="true"><i id="heartFill"></i></div>
          <small> </small>
        </div>

        <div class="pill" title="Language">
          <small id="txtLangLabel">è¨€èª</small>
          <select id="langSel" class="langSel" aria-label="Language">
            <option value="ja">æ—¥æœ¬èª</option>
            <option value="en">English</option>
            <option value="zh">ä¸­æ–‡</option>
          </select>
        </div>

        <div class="pill toggle" id="sitterToggle" data-on="false" title="ã‚·ãƒƒã‚¿ãƒ¼ONã§æ™‚é–“ãŒæ­¢ã¾ã‚Šã¾ã™ï¼ˆå¯¿å‘½ãƒ»ç©ºè…¹ãƒ»æ’æ³„ãƒ»çŠ¶æ…‹å¤‰åŒ–ã™ã¹ã¦åœæ­¢ï¼‰">
          <small id="txtSitter">ã‚·ãƒƒã‚¿ãƒ¼</small>
          <div class="switch" aria-hidden="true"></div>
        </div>
      </div>
    </div>

    <div id="screenGame" class="screen show">
      <div class="main">
        <div class="card">
          <div class="cardHeader">
            <div>
              <div class="h" id="txtStageHeader">ã‚¹ãƒ†ãƒ¼ã‚¸</div>
              <div class="hint" id="stageHint"> </div>
            </div>
            <div class="btnRow">
              <button class="btnGhost" id="btnShare">è¦³å¯Ÿç”¨URL</button>
              <button class="btnGhost" id="btnLogs">ãƒ­ã‚°</button>
              <button class="btnGhost" id="btnName">åå‰</button>
              <button class="btnGhost" id="btnReset">ã¯ã˜ã‚ã‹ã‚‰</button>
            </div>
          </div>

          <div class="stage">
            <div class="sky"></div>
            <div class="stars"></div>

            <div class="center">
              <div class="entity">
                <div id="macaronArea" class="macaronWrap floaty" style="display:none;">
                  <img id="macaronImg" class="macaronImg" alt="" src="" />
                </div>

                <div id="charArea" class="charWrap floaty" style="display:none;">
                  <img id="charImg" class="charImg" alt="" src="" />
                  <div class="tears" aria-hidden="true">
                    <div class="tear"></div>
                    <div class="tear"></div>
                  </div>
                </div>
              </div>

              <div class="poops" aria-hidden="true">
                <div class="poop" id="poop1"></div>
                <div class="poop" id="poop2"></div>
                <div class="poop" id="poop3"></div>
              </div>

              <div class="stageNote" id="stageNote"></div>
            </div>

            <div class="centerOverlay" id="thanksOverlay" aria-hidden="true">
              <div class="thanks" id="txtThanks">ã‚ã‚ŠãŒã¨ã†</div>
            </div>
          </div>
        </div>

        <div class="rightPane">
          <div class="card">
            <div class="cardHeader">
              <div>
                <div class="h" id="txtCareHeader">ãŠä¸–è©±</div>
                <div class="hint" id="txtCareHint">å¥½ããªæ–¹ã‚’é¸ã‚“ã§ãã ã•ã„</div>
              </div>
            </div>

            <div class="actions">
              <div id="letterSlot" class="letterSlot" aria-label="ãŠæ‰‹ç´™">
                <button id="letterBtn" class="letterBtn" type="button" aria-label="ãŠæ‰‹ç´™ã‚’èª­ã‚€">
                  <span class="letterIcon">âœ‰</span>
                  <span class="letterHint" id="txtLetterBtn">ãŠæ‰‹ç´™</span>
                </button>
              </div>

              <div class="grid">
                <button id="btnFood">ğŸ½ é£Ÿäº‹</button>
                <button id="btnOut">ğŸš€ ãŠã§ã‹ã‘</button>
                <button id="btnStyle">âœ¨ ãŠã—ã‚ƒã‚Œ</button>
                <button id="btnClean">ğŸ§¼ æ’æ³„é™¤å»</button>
              </div>
              <div class="grid">
                <button id="btnDrink">ğŸ¥¤ ãƒ‰ãƒªãƒ³ã‚¯</button>
                <button id="btnMacaron" disabled>ğŸ¬ ãƒã‚«ãƒ­ãƒ³</button>
              </div>
              <div class="mini" id="assetHint"></div>
            </div>
          </div>

          <div class="card">
            <div class="cardHeader">
              <div>
                <div class="h"></div>
                <div class="hint"></div>
              </div>
            </div>
            <div class="logPane">
              <div class="mini" id="txtMiniInfo">è¡¨æƒ…ã‚„å‹•ãã ã‘ã§çŠ¶æ…‹ãŒå¤‰ã‚ã‚Šã¾ã™ã€‚</div>
              <div class="logList" id="liveLog"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="screenObserve" class="screen">
      <div class="card">
        <div class="cardHeader">
          <div>
            <div class="h" id="txtObserveHeader">è¦³å¯Ÿç”¨ãƒ­ã‚°</div>
            <div class="hint" id="txtObserveHint">æ“ä½œã¯ã§ãã¾ã›ã‚“ï¼ˆãƒ­ã‚°ã¨ãƒãƒ¼ãƒˆæ¨ç§»ã®ã¿ï¼‰</div>
          </div>
          <div class="btnRow">
            <button id="btnBackToGame" class="btnGhost">æˆ»ã‚‹</button>
          </div>
        </div>

        <div class="observeWrap">
          <div class="observeHeader">
            <div>
              <div class="h" id="obsTitle"> </div>
              <div class="p" id="obsSub"> </div>
            </div>
          </div>

          <div class="chartBox">
            <canvas id="heartChart" width="900" height="220"></canvas>
          </div>

          <div class="days" id="obsDays"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="modalBack" id="modalBack" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal">
      <div class="modalHead">
        <div>
          <div class="h" id="modalTitle"> </div>
          <div class="hint" id="modalHint"> </div>
        </div>
        <button id="modalX" class="btnGhost" style="padding:8px 10px;">é–‰ã˜ã‚‹</button>
      </div>
      <div class="modalBody" id="modalBody"></div>
      <div class="modalFoot" id="modalFoot"></div>
    </div>
  </div>

  <div class="letterModal" id="letterModal" aria-hidden="true">
    <div class="letterPaper" role="dialog" aria-modal="true">
      <div class="letterHead">
        <b id="txtLetterTitle">ãŠæ‰‹ç´™</b>
        <button id="letterX" class="btnGhost" style="padding:8px 10px;">é–‰ã˜ã‚‹</button>
      </div>
      <div class="letterBody">
        <div class="letterText" id="letterText"></div>
      </div>
      <div class="letterFoot">
        <button id="letterClose" class="btnGhost">é–‰ã˜ã‚‹</button>
      </div>
    </div>
  </div>

<script>
(() => {
  "use strict";

  const ASSET_BASE = "public/char/";

  const url = new URL(location.href);
  const FAST = url.searchParams.get("fast") === "1";

  const SAVE_KEY = "osewa_save_2d_char_v2";
  const ARCHIVE_KEY = "osewa_archives_2d_char_v2";

  const DAY_MS  = 24 * 60 * 60 * 1000;
  const LIFE_MS = 3 * DAY_MS;

  const HATCH_MS = FAST ? 12 * 1000 : 3 * 60 * 1000;

  const LETTER_DELAY_MS = FAST ? 2500 : 30 * 1000;

  const MACARON_REVIVE_MS = FAST ? 18 * 1000 : 10 * 60 * 1000;
  const DRINK_EXTEND_MS   = FAST ? 20 * 1000 : 60 * 60 * 1000;
  const DRINK_BACK_MS     = FAST ?  8 * 1000 : 30 * 60 * 1000;

  const SLEEP_MS = FAST ? 10 * 1000 : 2 * 60 * 1000;

  const HUNGER_PER_MIN = 0.25;
  const DIRT_PER_MIN   = 0.18;

  const COLORS = ["blue","green","pink","purple"];

  // sleep ã¯ "sleep_" å½¢å¼ï¼ˆä¾‹: blue_sleep.pngï¼‰ã¸å¤‰æ›´
  // æ—§å½¢å¼ï¼ˆblue/sleep.pngï¼‰ã‚‚ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§æ‹¾ã†
  const FILES = {
    macaron: {
      blue:   "macaron_blue.png",
      green:  "macaron_green.png",
      pink:   "macaron_pink.png",
      purple: "macaron_purple.png",
    },
    char: {
      blue:   { closed:"blue_closed.png",   open:"blue_open.png",   sleep:"blue_sleep.png",   sleepFallback:"blue/sleep.png" },
      green:  { closed:"green_closed.png",  open:"green_open.png",  sleep:"green_sleep.png",  sleepFallback:"green/sleep.png" },
      purple: { closed:"purple_closed.png", open:"purple_open.png", sleep:"purple_sleep.png", sleepFallback:"purple/sleep.png" },
      // ãƒ”ãƒ³ã‚¯ç³»ã¯ pick ã‚’å„ªå…ˆï¼ˆpick_sleep.pngï¼‰ã€‚æ—§ pick/sleep.pngã€pink_sleep.png ã‚‚ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã€‚
      pink:   { closed:"pink_closed.png",   open:"pink_open.png",   sleep:"pick_sleep.png",   sleepFallback:"pick/sleep.png", sleepFallback2:"pink_sleep.png" },
    }
  };

  const LANG_KEY = "osewa_lang_v2";
  function getLang(){
    const v = localStorage.getItem(LANG_KEY);
    return (v === "en" || v === "zh" || v === "ja") ? v : "ja";
  }
  let LANG = getLang();

  const I18N = {
    ja: {
      docTitle: "3æ—¥é–“ã®ãŠä¸–è©±ã‚²ãƒ¼ãƒ ï¼ˆ2Dï¼‰",
      gameTitle: "3æ—¥é–“ã®ãŠä¸–è©±ã‚²ãƒ¼ãƒ ï¼ˆ2Dï¼‰",
      langLabel: "è¨€èª",
      sitter: "ã‚·ãƒƒã‚¿ãƒ¼",
      stageHeader: "ã‚¹ãƒ†ãƒ¼ã‚¸",
      careHeader: "ãŠä¸–è©±",
      careHint: "å¥½ããªæ–¹ã‚’é¸ã‚“ã§ãã ã•ã„",
      letter: "ãŠæ‰‹ç´™",
      observeHeader: "è¦³å¯Ÿç”¨ãƒ­ã‚°",
      observeHint: "æ“ä½œã¯ã§ãã¾ã›ã‚“ï¼ˆãƒ­ã‚°ã¨ãƒãƒ¼ãƒˆæ¨ç§»ã®ã¿ï¼‰",
      btnShare: "è¦³å¯Ÿç”¨URL",
      btnLogs: "ãƒ­ã‚°",
      btnName: "åå‰",
      btnReset: "ã¯ã˜ã‚ã‹ã‚‰",
      btnBack: "æˆ»ã‚‹",
      btnClose: "é–‰ã˜ã‚‹",
      btnCancel: "ã‚„ã‚ã‚‹",
      btnCopy: "ã‚³ãƒ”ãƒ¼",
      btnLater: "ã‚ã¨ã§",
      btnDecide: "æ±ºå®š",
      btnFood: "é£Ÿäº‹",
      btnOut: "ãŠã§ã‹ã‘",
      btnStyle: "ãŠã—ã‚ƒã‚Œ",
      btnClean: "æ’æ³„é™¤å»",
      btnDrink: "ãƒ‰ãƒªãƒ³ã‚¯",
      btnMacaron: "ãƒã‚«ãƒ­ãƒ³",
      twoChoice: "2æŠ",
      timeStopped: "æ™‚é–“ãŒæ­¢ã¾ã£ã¦ã„ã‚‹ã€‚",
      hatchingSoon: "ã—ã°ã‚‰ãã—ã¦ã€æµ®ã‹ã³ä¸ŠãŒã‚‹ã€‚",
      waitNote: "ã©ã‚“ãªå­ã‹ãªï¼Ÿã¡ã‚‡ã£ã¨å¾…ã£ã¦ã­",
      sleepNote: "ã™ã‚„ã™ã‚„â€¦",
      thisPet: "ã“ã®å­ï¼š",
      subRunning: "ãƒ­ã‚°è¨˜éŒ²",
      subEnded: "æ“ä½œã¯åœæ­¢ã—ã¾ã™",
      thanks: "ã‚ã‚ŠãŒã¨ã†",
      miniInfo: "è¡¨æƒ…ã‚„å‹•ãã ã‘ã§çŠ¶æ…‹ãŒå¤‰ã‚ã‚Šã¾ã™ã€‚",
      assetHint: "ç”»åƒãƒ‘ã‚¹",
      shareTitle: "è¦³å¯Ÿç”¨URL",
      shareHint: "å…±æœ‰ã™ã‚‹ã¨ãƒ­ã‚°ã ã‘è¦‹ã‚‰ã‚Œã¾ã™",
      shareText: "ã“ã®URLã‚’å…±æœ‰ã™ã‚‹ã¨ã€ç¬¬ä¸‰è€…ã¯ã€Œè¦³å¯Ÿç”¨ãƒ­ã‚°ç”»é¢ã€ã ã‘ã‚’é–²è¦§ã§ãã¾ã™ã€‚\næ“ä½œã¯ã§ãã¾ã›ã‚“ã€‚è¦‹ãˆã‚‹ã®ã¯ãƒ­ã‚°ã¨ãƒãƒ¼ãƒˆæ¨ç§»ã®ã¿ã§ã™ã€‚",
      shareCopied: "URLã‚’ã‚³ãƒ”ãƒ¼ã—ãŸã€‚",
      shareShown: "URLã‚’è¡¨ç¤ºã—ãŸã€‚",
      letterLines: [
        "ã‚ãªãŸã¯ã€å¤œç©ºã‹ã‚‰ã“ã¼ã‚Œè½ã¡ãŸã€Œãƒã‚«ãƒ­ãƒ³æ˜Ÿã®ãŸã¾ã”ã€ã‚’è¦‹ã¤ã‘ã¾ã—ãŸã€‚",
        "æ®»ã®ä¸­ã§ã¯ã€ç”˜ã„ã²ã‹ã‚ŠãŒã“ã‚ã“ã‚æºã‚Œã¦ã„ã¾ã™ã€‚",
        "ã“ã®å­ã¯ã€ãŸã£ãŸï¼“æ—¥ã ã‘ã€ã‚ãªãŸã®ãã°ã«ã„ã‚‰ã‚Œã¾ã™ã€‚",
        "ï¼“æ—¥ãŸã£ãŸã‚‰ã€ãƒã‚«ãƒ­ãƒ³æ˜Ÿã¸å¸°ã£ã¦ã—ã¾ã„ã¾ã™ã€‚",
        "ã§ã‚‚ã€ã¨ãã©ãã“ã“ã§é™ã‹ã«çœ ã£ã¦ã—ã¾ã†ã“ã¨ã‚‚ã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚",
        "ã ã‹ã‚‰ã“ãã€ã„ã¾ã ã‘ã¯ã€‚ã‚„ã•ã—ãè‚²ã¦ã¦ã­ã€‚"
      ],
      psName: "è¿½ä¼¸ï¼šã‚ˆã‹ã£ãŸã‚‰ã€ã“ã®å­ã«åå‰ã‚’ã¤ã‘ã¦ã‚ã’ã¦ãã ã•ã„ã€‚",
      nameTitle: "åå‰",
      nameHintInit: "ã“ã®å­ã«åå‰ã‚’ã¤ã‘ã¦ã­",
      nameHintEdit: " ",
      nameStoryEdit: "ã“ã®å­ã®åå‰ã‚’ã€ãã£ã¨å¤‰ãˆã¦ã¿ã‚‹ï¼Ÿ",
      namePlaceholder: "åå‰ï¼ˆ12æ–‡å­—ã¾ã§ï¼‰",
      nameNote: "ã‚ã¨ã§ã€Œåå‰ã€ãƒœã‚¿ãƒ³ã‹ã‚‰å¤‰æ›´ã§ãã¾ã™ã€‚",
      resetTitle: "ã¯ã˜ã‚ã‹ã‚‰",
      resetText: "ã¯ã˜ã‚ã‹ã‚‰éŠã¹ã¾ã™ã€‚\nãƒ­ã‚°ã¯ç—•è·¡ã¨ã—ã¦æ®‹ã™ã‹ã€æ¶ˆã™ã‹é¸ã¹ã¾ã™ã€‚",
      resetKeep: "ãƒ­ã‚°ã‚’æ®‹ã—ã¦ã¯ã˜ã‚ã‚‹",
      resetKeepSub: "éå»ã®ç—•è·¡ã¯ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã¸ã€‚",
      resetWipe: "ãƒ­ã‚°ã‚’æ¶ˆã—ã¦ã¯ã˜ã‚ã‚‹",
      resetWipeSub: "ã“ã®ç«¯æœ«ã®è¨˜éŒ²ã‚’æ¶ˆã—ã¾ã™ã€‚",
      resetCancel: "ã‚„ã‚ã‚‹",
      logArrived: "åˆ°ç€ã—ãŸã€‚",
      logStarted: "å§‹ã¾ã£ãŸã€‚",
      logHatched: "æµ®ã‹ã³ä¸ŠãŒã£ã¦ã€èª•ç”Ÿã—ãŸã€‚",
      logDayChanged: "æ—¥ãŒå¤‰ã‚ã£ãŸã€‚",
      logQuiet: "é™ã‹ã«ãªã£ãŸã€‚",
      logGone: "ã„ãªããªã£ãŸã€‚",
      logOff: "ã©ã“ã‹ã‚ºãƒ¬ãŸã¾ã¾ã€ã¾ãŸé™ã‹ã«ãªã£ãŸã€‚",
      logReadLetter: "æ‰‹ç´™ã‚’èª­ã‚“ã ã€‚",
      logNamed: "åå‰ã‚’ã¤ã‘ãŸï¼š",
      logSitterOn: "é ã‘ãŸã€‚",
      logSitterOff: "æˆ»ã£ãŸã€‚",
      missAsset: "ç”»åƒãŒè¦‹ã¤ã‹ã‚‰ãªã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“\n{src}\npublic/char/ ã®ä¸­ã«PNGãŒã‚ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„",
      cleanHow: "ã¾ãšã‚„ã‚Šæ–¹ã‚’é¸ã‚“ã§ã€å‡ºã¦ã„ã‚‹ã‚‚ã®ã‚’ã‚¿ãƒƒãƒ—ã—ã¦æ¶ˆã—ã¾ã™ã€‚\næ”¾ç½®ã™ã‚‹ã¨çŠ¶æ…‹ãŒã‚†ã£ãã‚Šæ‚ªåŒ–ã—ã¾ã™ã€‚",
      tapToErase: "ã‚¿ãƒƒãƒ—ã—ã¦æ¶ˆã™ï¼ˆæ®‹ã‚Š {n}ï¼‰",
      autoBack: "çµ‚ã‚ã£ãŸã‚‰è‡ªå‹•ã§æˆ»ã‚Šã¾ã™ã€‚",
      drinkAsk: "ãƒ‰ãƒªãƒ³ã‚¯ã‚’ä½¿ã†ï¼Ÿ\nå°‘ã—ã ã‘æ™‚é–“ã‚„çŠ¶æ…‹ãŒæˆ»ã‚‹ï¼å»¶ã³ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ç†ç”±ã¯èª¬æ˜ã—ã¾ã›ã‚“ã€‚\nä½¿ç”¨ã¯ãƒ­ã‚°ã«æ®‹ã‚Šã¾ã™ã€‚",
      macaronAsk: "ãƒã‚«ãƒ­ãƒ³ã‚’ä½¿ã†ï¼Ÿ\nä¸€æ™‚çš„ã«æˆ»ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€å®Œå…¨ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚\nä½¿ç”¨ã¯ãƒ­ã‚°ã«æ®‹ã‚Šã¾ã™ã€‚",
      use: "ä½¿ã†",
      notUse: "ä½¿ã‚ãªã„",
      onlyAlive: "ç”Ÿå­˜ä¸­ã®ã¿",
      onlyAfter: "æ­»å¾Œã®ã¿",
      chose: "ã‚’é¸ã‚“ã ã€‚",
      decided: "ã«ã—ãŸã€‚",
      cleaned: "ãã‚Œã„ã«ã—ãŸã€‚",
      usedDrink: "ãƒ‰ãƒªãƒ³ã‚¯ã‚’ä½¿ã£ãŸã€‚",
      returned: "æˆ»ã£ã¦ããŸã€‚"
    },
    en: {
      docTitle: "3-Day Care Game (2D)",
      gameTitle: "3-Day Care Game (2D)",
      langLabel: "Language",
      sitter: "Sitter",
      stageHeader: "Stage",
      careHeader: "Care",
      careHint: "Choose whichever you like",
      letter: "Letter",
      observeHeader: "Observer Log",
      observeHint: "No controls (logs and heart trend only)",
      btnShare: "Observer URL",
      btnLogs: "Logs",
      btnName: "Name",
      btnReset: "Restart",
      btnBack: "Back",
      btnClose: "Close",
      btnCancel: "Cancel",
      btnCopy: "Copy",
      btnLater: "Later",
      btnDecide: "OK",
      btnFood: "Food",
      btnOut: "Go out",
      btnStyle: "Style",
      btnClean: "Clean",
      btnDrink: "Drink",
      btnMacaron: "Macaron",
      twoChoice: "Two choices",
      timeStopped: "Time is paused.",
      hatchingSoon: "Soon, something will riseâ€¦",
      waitNote: "What kind of child will it be? Please wait a moment.",
      sleepNote: "Zzzâ€¦",
      thisPet: "This one: ",
      subRunning: "Logging",
      subEnded: "Controls disabled",
      thanks: "Thanks",
      miniInfo: "Status changes from expressions and motion.",
      assetHint: "Asset path",
      shareTitle: "Observer URL",
      shareHint: "Shareable (log only)",
      shareText: "Sharing this URL lets others view only the observer log screen.\nThey cannot play. Only logs and heart trend are visible.",
      shareCopied: "URL copied.",
      shareShown: "URL shown.",
      letterLines: [
        "You found a â€˜macaron-star eggâ€™ that slipped from the night sky.",
        "Inside the shell, a sweet light gently rolls around.",
        "This child can stay with you for only three days.",
        "After three days, it will return to the macaron star.",
        "Sometimes, it may quietly fall asleep here as well.",
        "Thatâ€™s whyâ€”just for nowâ€”please care for it gently."
      ],
      psName: "P.S. If youâ€™d like, please give this child a name.",
      nameTitle: "Name",
      nameHintInit: "Please name this child",
      nameHintEdit: " ",
      nameStoryEdit: "Want to quietly change the name?",
      namePlaceholder: "Name (up to 12 chars)",
      nameNote: "You can change it later with the Name button.",
      resetTitle: "Restart",
      resetText: "You can start over.\nChoose whether to keep traces (archive) or erase them.",
      resetKeep: "Restart (keep logs)",
      resetKeepSub: "Past traces go to archive.",
      resetWipe: "Restart (erase logs)",
      resetWipeSub: "Erase records on this device.",
      resetCancel: "Cancel",
      logArrived: "Arrived.",
      logStarted: "Started.",
      logHatched: "It rose and was born.",
      logDayChanged: "A new day began.",
      logQuiet: "It became quiet.",
      logGone: "It is gone.",
      logOff: "It returnedâ€¦ but slightly off, and became quiet again.",
      logReadLetter: "Read the letter.",
      logNamed: "Named: ",
      logSitterOn: "Paused (sitter).",
      logSitterOff: "Resumed.",
      missAsset: "This image may be missing:\n{src}\nPlease check PNGs under public/char/",
      cleanHow: "First choose how to clean, then tap the mess to erase it.\nIf you leave it, the status will slowly get worse.",
      tapToErase: "Tap to erase (left: {n})",
      autoBack: "You will return automatically when done.",
      drinkAsk: "Use a drink?\nIt may slightly restore/extend time or status. No explanation.\nYour choice will be logged.",
      macaronAsk: "Use a macaron?\nIt may bring it back briefly, but not perfectly.\nYour choice will be logged.",
      use: "Use",
      notUse: "Not now",
      onlyAlive: "Only while alive",
      onlyAfter: "Only after death",
      chose: " selected.",
      decided: " chosen.",
      cleaned: "Cleaned.",
      usedDrink: "Used a drink.",
      returned: "It came back."
    },
    zh: {
      docTitle: "ä¸‰å¤©ç…§æŠ¤æ¸¸æˆï¼ˆ2Dï¼‰",
      gameTitle: "ä¸‰å¤©ç…§æŠ¤æ¸¸æˆï¼ˆ2Dï¼‰",
      langLabel: "è¯­è¨€",
      sitter: "æ‰˜ç®¡",
      stageHeader: "èˆå°",
      careHeader: "ç…§æŠ¤",
      careHint: "è¯·é€‰æ‹©ä½ å–œæ¬¢çš„ä¸€ä¸ª",
      letter: "ä¿¡",
      observeHeader: "è§‚å¯Ÿè®°å½•",
      observeHint: "æ— æ³•æ“ä½œï¼ˆä»…æ˜¾ç¤ºè®°å½•ä¸å¿ƒå€¼è¶‹åŠ¿ï¼‰",
      btnShare: "è§‚å¯Ÿé“¾æ¥",
      btnLogs: "è®°å½•",
      btnName: "åå­—",
      btnReset: "é‡æ–°å¼€å§‹",
      btnBack: "è¿”å›",
      btnClose: "å…³é—­",
      btnCancel: "å–æ¶ˆ",
      btnCopy: "å¤åˆ¶",
      btnLater: "ç¨å",
      btnDecide: "ç¡®å®š",
      btnFood: "åƒé¥­",
      btnOut: "å¤–å‡º",
      btnStyle: "æ‰“æ‰®",
      btnClean: "æ¸…ç†",
      btnDrink: "é¥®æ–™",
      btnMacaron: "é©¬å¡é¾™",
      twoChoice: "äºŒé€‰ä¸€",
      timeStopped: "æ—¶é—´å·²æš‚åœã€‚",
      hatchingSoon: "å†ç­‰ä¸€ä¼šå„¿ï¼Œå®ƒä¼šæµ®ç°å‡ºæ¥â€¦",
      waitNote: "ä¼šæ˜¯ä»€ä¹ˆæ ·çš„å­©å­å‘¢ï¼Ÿç¨ç­‰ä¸€ä¸‹å“¦ã€‚",
      sleepNote: "å‘¼å™œâ€¦",
      thisPet: "è¿™ä¸ªå­©å­ï¼š",
      subRunning: "è®°å½•ä¸­",
      subEnded: "å·²åœæ­¢æ“ä½œ",
      thanks: "è°¢è°¢",
      miniInfo: "è¡¨æƒ…ä¸åŠ¨ä½œä¼šå½±å“çŠ¶æ€ã€‚",
      assetHint: "èµ„æºè·¯å¾„",
      shareTitle: "è§‚å¯Ÿé“¾æ¥",
      shareHint: "åˆ†äº«åä»…å¯çœ‹è®°å½•",
      shareText: "åˆ†äº«æ­¤é“¾æ¥åï¼Œåˆ«äººåªèƒ½æŸ¥çœ‹â€œè§‚å¯Ÿè®°å½•â€ç”»é¢ã€‚\nä¸èƒ½è¿›è¡Œæ¸¸æˆæ“ä½œï¼Œåªèƒ½çœ‹åˆ°è®°å½•ä¸å¿ƒå€¼è¶‹åŠ¿ã€‚",
      shareCopied: "å·²å¤åˆ¶é“¾æ¥ã€‚",
      shareShown: "å·²æ˜¾ç¤ºé“¾æ¥ã€‚",
      letterLines: [
        "ä½ æ¡åˆ°äº†ä¸€æšä»å¤œç©ºä¸­è½ä¸‹çš„â€œé©¬å¡é¾™æ˜Ÿä¹‹è›‹â€ã€‚",
        "è›‹å£³é‡Œï¼Œç”œç”œçš„å…‰åœ¨è½»è½»æ»šåŠ¨ã€‚",
        "è¿™ä¸ªå­©å­åªèƒ½é™ªä½ ä¸‰å¤©ã€‚",
        "ä¸‰å¤©åï¼Œå®ƒä¼šå›åˆ°é©¬å¡é¾™æ˜Ÿã€‚",
        "ä¸è¿‡ï¼Œæœ‰æ—¶å®ƒä¹Ÿå¯èƒ½åœ¨è¿™é‡Œé™é™ç¡å»ã€‚",
        "æ‰€ä»¥â€”â€”å°±åœ¨æ­¤åˆ»â€”â€”è¯·æ¸©æŸ”åœ°ç…§é¡¾å®ƒã€‚"
      ],
      psName: "é™„è¨€ï¼šå¦‚æœæ„¿æ„ï¼Œè¯·ç»™è¿™ä¸ªå­©å­å–ä¸ªåå­—ã€‚",
      nameTitle: "åå­—",
      nameHintInit: "è¯·ç»™å®ƒå–ä¸ªåå­—",
      nameHintEdit: " ",
      nameStoryEdit: "æƒ³æ‚„æ‚„æ”¹ä¸€ä¸‹åå­—å—ï¼Ÿ",
      namePlaceholder: "åå­—ï¼ˆæœ€å¤š12å­—ï¼‰",
      nameNote: "ä¹‹åä¹Ÿå¯ä»¥ç”¨â€œåå­—â€æŒ‰é’®ä¿®æ”¹ã€‚",
      resetTitle: "é‡æ–°å¼€å§‹",
      resetText: "å¯ä»¥ä»å¤´å¼€å§‹ã€‚\nè¯·é€‰æ‹©ä¿ç•™ç—•è¿¹ï¼ˆå½’æ¡£ï¼‰æˆ–æ¸…é™¤è®°å½•ã€‚",
      resetKeep: "ä¿ç•™è®°å½•é‡æ–°å¼€å§‹",
      resetKeepSub: "è¿‡å»ç—•è¿¹ä¼šå½’æ¡£ã€‚",
      resetWipe: "æ¸…é™¤è®°å½•é‡æ–°å¼€å§‹",
      resetWipeSub: "æ¸…é™¤æœ¬è®¾å¤‡è®°å½•ã€‚",
      resetCancel: "å–æ¶ˆ",
      logArrived: "å·²åˆ°è¾¾ã€‚",
      logStarted: "å·²å¼€å§‹ã€‚",
      logHatched: "å®ƒæµ®èµ·å¹¶è¯ç”Ÿäº†ã€‚",
      logDayChanged: "æ–°çš„ä¸€å¤©å¼€å§‹äº†ã€‚",
      logQuiet: "å®ƒå®‰é™ä¸‹æ¥äº†ã€‚",
      logGone: "å®ƒç¦»å¼€äº†ã€‚",
      logOff: "å®ƒå›æ¥äº†â€¦ä½†æœ‰ç‚¹ä¸ä¸€æ ·ï¼Œåˆå®‰é™äº†ã€‚",
      logReadLetter: "è¯»äº†ä¿¡ã€‚",
      logNamed: "å–åï¼š",
      logSitterOn: "å·²æ‰˜ç®¡ï¼ˆæš‚åœï¼‰ã€‚",
      logSitterOff: "å·²æ¢å¤ã€‚",
      missAsset: "å¯èƒ½æ‰¾ä¸åˆ°å›¾ç‰‡ï¼š\n{src}\nè¯·ç¡®è®¤ public/char/ ä¸‹æ˜¯å¦æœ‰PNG",
      cleanHow: "å…ˆé€‰æ‹©æ¸…ç†æ–¹å¼ï¼Œç„¶åç‚¹å‡»è„ä¸œè¥¿æŠŠå®ƒæ¸…é™¤ã€‚\nå¦‚æœæ”¾ç€ä¸ç®¡ï¼ŒçŠ¶æ€ä¼šæ…¢æ…¢å˜å·®ã€‚",
      tapToErase: "ç‚¹å‡»æ¸…é™¤ï¼ˆå‰©ä½™ {n}ï¼‰",
      autoBack: "å®Œæˆåä¼šè‡ªåŠ¨è¿”å›ã€‚",
      drinkAsk: "è¦ä½¿ç”¨é¥®æ–™å—ï¼Ÿ\nå®ƒå¯èƒ½ç¨å¾®æ¢å¤/å»¶é•¿æ—¶é—´æˆ–çŠ¶æ€ã€‚ä¸è§£é‡ŠåŸå› ã€‚\nä½ çš„é€‰æ‹©ä¼šè¢«è®°å½•ã€‚",
      macaronAsk: "è¦ä½¿ç”¨é©¬å¡é¾™å—ï¼Ÿ\nå®ƒå¯èƒ½è®©å®ƒçŸ­æš‚å›æ¥ï¼Œä½†ä¸ä¼šå®Œç¾ã€‚\nä½ çš„é€‰æ‹©ä¼šè¢«è®°å½•ã€‚",
      use: "ä½¿ç”¨",
      notUse: "æš‚ä¸ä½¿ç”¨",
      onlyAlive: "ä»…åœ¨å­˜æ´»æ—¶",
      onlyAfter: "ä»…åœ¨ç¦»å¼€å",
      chose: " å·²é€‰æ‹©ã€‚",
      decided: " å·²å†³å®šã€‚",
      cleaned: "å·²æ¸…ç†ã€‚",
      usedDrink: "ä½¿ç”¨äº†é¥®æ–™ã€‚",
      returned: "å®ƒå›æ¥äº†ã€‚"
    }
  };

  function t(key){
    return (I18N[LANG] && I18N[LANG][key]) || I18N.ja[key] || key;
  }
  function getLetterBody(){
    const lines = t("letterLines");
    const arr = Array.isArray(lines) ? lines : I18N.ja.letterLines;
    return arr.join("\n") + "\n\n" + t("psName");
  }
  function getIntroText(){
    const lines = t("letterLines");
    const arr = Array.isArray(lines) ? lines : I18N.ja.letterLines;
    return arr.join("\n");
  }
  function setLang(lang){
    LANG = (lang === "en" || lang === "zh" || lang === "ja") ? lang : "ja";
    localStorage.setItem(LANG_KEY, LANG);
    applyLangToUI();
    if(ui.letterText) ui.letterText.textContent = getLetterBody();
  }

  function makeOpt(icon, title, sub, extra){
    return Object.assign({ icon, t:title, sub }, extra || {});
  }
  function makePrompt(q, a, b){
    return { q, a, b };
  }

  // 2æŠã®æ–‡ç« ã‚‚è¨€èªåˆ¥ã«ç”¨æ„
  // æ³¨æ„ï¼šå„è¨€èªã§é…åˆ—é•·ã‚’æƒãˆã¦ã„ã¾ã™ï¼ˆé€”ä¸­ã§è¨€èªã‚’å¤‰ãˆã¦ã‚‚ç ´ç¶»ã—ã«ãã„ï¼‰
  const TWOCHOICE = {
    ja: {
      food: [
        makePrompt("æ˜Ÿããšã”ã¯ã‚“ã€ã©ã£ã¡ï¼Ÿ",
          makeOpt("ğŸ™","æ˜ŸãŠã«ãã‚Š","ãã‚…ã£ã¨å…‰ã‚‹ã€‚"),
          makeOpt("ğŸ¥","æœˆã®ã‚¯ãƒ­ãƒ¯ãƒƒã‚µãƒ³","å±¤ãŒãµã‚ã‚Šã€‚")
        ),
        makePrompt("ã‚ã£ãŸã‹ã„ï¼Ÿã¤ã‚ãŸã„ï¼Ÿ",
          makeOpt("ğŸœ","ã»ã—ãƒ©ãƒ¼ãƒ¡ãƒ³","æ¹¯æ°—ãŒå®‡å®™èˆ¹ã€‚"),
          makeOpt("ğŸ¥—","é™ã‹ãªã‚µãƒ©ãƒ€","è‘‰ã£ã±ãŒã•ã•ã‚„ãã€‚")
        ),
        makePrompt("æ‰‹æ—©ãã„ãï¼Ÿã‚†ã£ãã‚Šã„ãï¼Ÿ",
          makeOpt("ğŸ®","ã·ã‚‹ã·ã‚‹ã‚¼ãƒªãƒ¼","ã¤ã‚‹ã£ã¨ã€‚"),
          makeOpt("ğŸ›","ã‚†ã£ãã‚Šã‚«ãƒ¬ãƒ¼","æ™‚é–“ã®åŒ‚ã„ã€‚")
        ),
        makePrompt("è‰²ã§é¸ã¶ãªã‚‰ï¼Ÿ",
          makeOpt("ğŸš","ã¾ã£ç™½ã”ã¯ã‚“","ã¾ã£ã™ãã€‚"),
          makeOpt("ğŸ","ã“ã’è‰²ãƒ‘ãƒ³","ã²ã­ã£ã¦ã‚‹ã€‚")
        ),
        makePrompt("ç”˜ã„æ˜Ÿã®ã²ã¨å£ã€ã©ã£ã¡ï¼Ÿ",
          makeOpt("ğŸ«","å¤œãƒãƒ§ã‚³","é»’ã®å®‰å¿ƒã€‚"),
          makeOpt("ğŸ“","æœã„ã¡ã”","èµ¤ã®ãã‚‰ã‚ãã€‚")
        ),
        makePrompt("ãƒ‘ãƒªãƒƒã¨ï¼Ÿã‚‚ã¡ã£ã¨ï¼Ÿ",
          makeOpt("ğŸ¥Ÿ","å°ã•ãªé¤ƒå­","æœˆé¢ã®éŸ³ã€‚"),
          makeOpt("ğŸ¡","ä¸‰è‰²ã ã‚“ã”","æ‰‹ã®ã²ã‚‰ç¥­ã‚Šã€‚")
        ),
        makePrompt("ã‚¹ãƒ¼ãƒ—ã§åŒ…ã‚€ï¼Ÿç„¼ã„ã¦é¦™ã‚‹ï¼Ÿ",
          makeOpt("ğŸ²","æ˜Ÿã®ã‚¹ãƒ¼ãƒ—","æ¹¯æ°—ãŒãµã‚ãµã‚ã€‚"),
          makeOpt("ğŸ•","å°ã•ãªãƒ”ã‚¶","é¦™ã‚ŠãŒå…ˆã«æ¥ã‚‹ã€‚")
        ),
        makePrompt("æµ·ã®æ°—é…ã€ã©ã£ã¡ï¼Ÿ",
          makeOpt("ğŸ£","ãã‚‰ã‚Šå¯¿å¸","æ³¢ã®è§’åº¦ã€‚"),
          makeOpt("ğŸ¦","ãˆã³ãƒ•ãƒ©ã‚¤","è¡£ãŒæ˜Ÿå±‘ã€‚")
        ),
        makePrompt("ãµã‚ã£ã¨ï¼Ÿã—ã‚ƒãã£ã¨ï¼Ÿ",
          makeOpt("ğŸ§","é›²ã®ã‚«ãƒƒãƒ—ã‚±ãƒ¼ã‚­","å£ã©ã‘ãŒæ—©ã„ã€‚"),
          makeOpt("ğŸ¥ª","å½±ã®ã‚µãƒ³ãƒ‰","å™›ã‚€ã»ã©å¢—ãˆã‚‹ã€‚")
        ),
        makePrompt("ã‚ã¾ã„äºˆæ„Ÿã€ã©ã£ã¡ï¼Ÿ",
          makeOpt("ğŸª","ã»ã‚ã»ã‚ã‚¯ãƒƒã‚­ãƒ¼","éŸ³ãŒå„ªã—ã„ã€‚"),
          makeOpt("ğŸ§‡","ç„¼ããƒ¯ãƒƒãƒ•ãƒ«","æ ¼å­ãŒå¬‰ã—ã„ã€‚")
        ),
        makePrompt("å°ã•ãå¹¸ã›ã€ã©ã£ã¡ï¼Ÿ",
          makeOpt("ğŸ§€","ã²ã¨ãã¡ãƒãƒ¼ã‚º","é™ã‹ã«æ¿ƒã„ã€‚"),
          makeOpt("ğŸ¯","ã¯ã¡ã¿ã¤ã²ã‹ã‚Š","ã¨ã‚ã‚Šé•·ã„ã€‚")
        ),
        makePrompt("æœç‰©ã®æ˜Ÿã€ã©ã£ã¡ï¼Ÿ",
          makeOpt("ğŸ‘","ã‚‚ã‚‚è‰²ã®å¤¢","ã‚„ã‚ã‚‰ã‹ã„è¼ªéƒ­ã€‚"),
          makeOpt("ğŸ‡","ã¶ã©ã†ã®å¤œ","ç²’ãŒä¸¦ã¶ã€‚")
        ),
        makePrompt("ã±ã¡ã±ã¡ï¼Ÿã—ã£ã¨ã‚Šï¼Ÿ",
          makeOpt("ğŸ¿","å®‡å®™ãƒãƒƒãƒ—","ã¯ã˜ã‘ã‚‹ã€‚"),
          makeOpt("ğŸ°","ã—ã£ã¨ã‚Šã‚±ãƒ¼ã‚­","è½ã¡ç€ãã€‚")
        ),
        makePrompt("ã‚ã£ãŸã‹åŒ…ã‚€ï¼Ÿå†·ãŸãæ¾„ã‚€ï¼Ÿ",
          makeOpt("ğŸ¥Ÿ","ãŠã¾ã˜ãªã„è’¸ã—","ç™½ã„æ¹¯æ°—ã€‚"),
          makeOpt("ğŸ¨","æœˆã®ã‚¢ã‚¤ã‚¹","å†·ãˆãŸé’ã€‚")
        ),
        makePrompt("é¦™ã°ã—ã„ã®ã€ã©ã£ã¡ï¼Ÿ",
          makeOpt("ğŸ¢","æ˜ŸãŠã§ã‚“ä¸²","æ¹¯æ°—ã®ä¼šè©±ã€‚"),
          makeOpt("ğŸ¥“","ã±ã‚Šãƒ™ãƒ¼ã‚³ãƒ³","éŸ³ãŒå‹ã¤ã€‚")
        ),
        makePrompt("ãµã—ããªé£²ã¿ã‚‚ã®ã€ã©ã£ã¡ï¼Ÿ",
          makeOpt("ğŸ§ƒ","æ˜Ÿã‚¸ãƒ¥ãƒ¼ã‚¹","æ˜ã‚‹ã„ç”˜ã•ã€‚"),
          makeOpt("ğŸ«–","é™ã‹ãªç´…èŒ¶","ä½™éŸ»ãŒé•·ã„ã€‚")
        ),
        makePrompt("ã“ã‚ã“ã‚ï¼Ÿã¨ã‚ã¨ã‚ï¼Ÿ",
          makeOpt("ğŸ™","å°ã•ãªã“ã‚ã‚“é£¯","æ‰‹ã®æ¸©åº¦ã€‚"),
          makeOpt("ğŸ","ã¨ã‚ã‚Šãƒ‘ã‚¹ã‚¿","ç³¸ãŒä¼¸ã³ã‚‹ã€‚")
        ),
        makePrompt("å…ƒæ°—ã‚’è¶³ã™ãªã‚‰ï¼Ÿ",
          makeOpt("ğŸŒ","ãƒãƒŠãƒŠã®å…‰","ã™ãåŠ¹ãã€‚"),
          makeOpt("ğŸ¥œ","ãƒŠãƒƒãƒ„ã®èŠ¯","ã‚ã¨ã§åŠ¹ãã€‚")
        ),
        makePrompt("éŸ³ã§é¸ã¶ãªã‚‰ï¼Ÿ",
          makeOpt("ğŸ¥¨","ã‹ã‚Šã‹ã‚Šãƒ—ãƒ¬ãƒƒãƒ„ã‚§ãƒ«","è»½ã„è¶³éŸ³ã€‚"),
          makeOpt("ğŸ","ãµã‚ãƒ‘ãƒ³","éŸ³ãŒæ¶ˆãˆã‚‹ã€‚")
        ),
        makePrompt("æœ€å¾Œã®ã²ã¨å£ã€ã©ã£ã¡ï¼Ÿ",
          makeOpt("ğŸ¬","å°ã•ãªé£´","é•·ãæ®‹ã‚‹ã€‚"),
          makeOpt("ğŸ‹","ãã‚…ã‚“ãƒ¬ãƒ¢ãƒ³","ä¸€ç¬ã¾ã¶ã—ã„ã€‚")
        ),
      ],
      out: [
        makePrompt("ã©ã£ã¡ã®æ™‚é–“ã«ã™ã‚‹ï¼Ÿ",
          makeOpt("ğŸŒ³","å…¬åœ’","é ãã®éŸ³ãŒã™ã‚‹ã€‚",{ wild:true }),
          makeOpt("ğŸ¬","æ˜ ç”»é¤¨","æš—ã„ã®ã«å®‰å¿ƒã€‚",{ wild:false })
        ),
        makePrompt("å¯„ã‚Šé“ã™ã‚‹ãªã‚‰ï¼Ÿ",
          makeOpt("ğŸ“š","æœ¬å±‹","èƒŒè¡¨ç´™ã®æ£®ã€‚",{ wild:false }),
          makeOpt("ğŸ•¹ï¸","ã‚²ãƒ¼ãƒ ã‚»ãƒ³ã‚¿ãƒ¼","å…‰ãŒå¼·ã„ã€‚",{ wild:false })
        ),
        makePrompt("æ°—é…ã‚’é¸ã¶ãªã‚‰ï¼Ÿ",
          makeOpt("ğŸŒŠ","æµ·","å¢ƒç•ŒãŒã‚†ã‚Œã‚‹ã€‚",{ wild:true }),
          makeOpt("ğŸ”ï¸","å±±","å¢ƒç•ŒãŒå›ºã„ã€‚",{ wild:true })
        ),
        makePrompt("å¸°ã‚Šé“ã®ç›¸æ£’ã¯ï¼Ÿ",
          makeOpt("ğŸ§ƒ","ã‚¸ãƒ¥ãƒ¼ã‚¹","æ˜ã‚‹ã„ç”˜ã•ã€‚",{ wild:false }),
          makeOpt("ğŸ¶","ãŠé…’","é™ã‹ãªç†±ã€‚",{ wild:false })
        ),
        makePrompt("ç©ºã‚’è¦‹ä¸Šã’ã‚‹ãªã‚‰ï¼Ÿ",
          makeOpt("ğŸŒ™","æœˆã®è¿‘ã","ç™½ãé™ã‹ã€‚",{ wild:false }),
          makeOpt("â­","æ˜Ÿã®å¤šã„å ´æ‰€","æ•°ãŒå¢—ãˆã‚‹ã€‚",{ wild:false })
        ),
        makePrompt("é¢¨ã®æ–¹å‘ã€ã©ã£ã¡ï¼Ÿ",
          makeOpt("ğŸª","é¢¨ã®åºƒå ´","ã²ã£ã±ã‚‰ã‚Œã‚‹ã€‚",{ wild:true }),
          makeOpt("â˜•","å–«èŒ¶ã®çª“","è½ã¡ç€ãã€‚",{ wild:false })
        ),
        makePrompt("å…‰ã‚’æµ´ã³ã‚‹ï¼Ÿå½±ã‚’æ­©ãï¼Ÿ",
          makeOpt("ğŸŒ","ã²ã ã¾ã‚Š","ã‚ã£ãŸã‹ã„ã€‚",{ wild:true }),
          makeOpt("ğŸŒŒ","æ˜Ÿå½±ã®é“","éŸ³ãŒç´°ã„ã€‚",{ wild:false })
        ),
        makePrompt("æºã‚Œã‚‹ã®ã€å¥½ãï¼Ÿ",
          makeOpt("ğŸ¡","è¦³è¦§è»Š","ã‚†ã£ãã‚Šå›ã‚‹ã€‚",{ wild:false }),
          makeOpt("ğŸšƒ","é›»è»Š","æ™¯è‰²ãŒæµã‚Œã‚‹ã€‚",{ wild:false })
        ),
        makePrompt("è¦‹ã¤ã‘ã‚‚ã®ã€ã©ã£ã¡ï¼Ÿ",
          makeOpt("ğŸª","å°ã•ãªéš•çŸ³å±‹","æ„å‘³ãŒå¢—ãˆã‚‹ã€‚",{ wild:false }),
          makeOpt("ğŸ§¸","ã¬ã„ãã‚‹ã¿å±‹","æŠ±ãã‚„ã™ã„ã€‚",{ wild:false })
        ),
        makePrompt("éŸ³ãŒå¤šã„ã®ã¯ï¼Ÿ",
          makeOpt("ğŸŸï¸","ã«ãã‚„ã‹åºƒå ´","ç¬‘ã„ãŒè·³ã­ã‚‹ã€‚",{ wild:true }),
          makeOpt("ğŸ•¯ï¸","é™ã‹ãªè·¯åœ°","è¶³éŸ³ã ã‘ã€‚",{ wild:false })
        ),
        makePrompt("æ°´è¾ºã«å¯„ã‚‹ï¼Ÿ",
          makeOpt("â›²","å™´æ°´","ãã‚‰ãã‚‰æ•£ã‚‹ã€‚",{ wild:true }),
          makeOpt("ğŸ›","æ¹¯ã®æ°—é…","ã¨ã‘ã‚‹ã€‚",{ wild:false })
        ),
        makePrompt("ãµãŸã‚Šã®é€Ÿåº¦ã¯ï¼Ÿ",
          makeOpt("ğŸš¶","ã®ã‚“ã³ã‚Šæ•£æ­©","è€ƒãˆãŒä¸¦ã¶ã€‚",{ wild:true }),
          makeOpt("ğŸƒ","å°èµ°ã‚Š","ç¬‘ã„ãŒå…ˆã€‚",{ wild:true })
        ),
        makePrompt("ç©ºã®ä¹—ã‚Šã‚‚ã®ã€ã©ã£ã¡ï¼Ÿ",
          makeOpt("ğŸ›¸","UFOã”ã£ã“","æµ®ã„ãŸæ°—åˆ†ã€‚",{ wild:false }),
          makeOpt("ğŸˆ","é¢¨èˆ¹æ—…","è»½ããªã‚‹ã€‚",{ wild:true })
        ),
        makePrompt("æ™¯è‰²ãŒå¤‰ã‚ã‚‹ã®ã¯ï¼Ÿ",
          makeOpt("ğŸ™ï¸","è¡—ã®ãƒã‚ªãƒ³","è‰²ãŒå¢—ãˆã‚‹ã€‚",{ wild:false }),
          makeOpt("ğŸŒ²","æ£®ã®å…¥å£","åŒ‚ã„ãŒå¢—ãˆã‚‹ã€‚",{ wild:true })
        ),
        makePrompt("ã²ã¨ä¼‘ã¿ã™ã‚‹ãªã‚‰ï¼Ÿ",
          makeOpt("ğŸ¦","ã‚¢ã‚¤ã‚¹å±‹","å†·ãˆã¦ç¬‘ã†ã€‚",{ wild:false }),
          makeOpt("ğŸ¥Ÿ","å±‹å°","æ¹¯æ°—ã§éš ã‚Œã‚‹ã€‚",{ wild:false })
        ),
        makePrompt("é ãã¸è¡Œãï¼Ÿè¿‘ãã§éŠã¶ï¼Ÿ",
          makeOpt("ğŸ—ºï¸","å°æ—…è¡Œ","æ€ã„å‡ºãŒå¢—ãˆã‚‹ã€‚",{ wild:true }),
          makeOpt("ğŸ²","è¿‘ãã®éŠã³","ä»ŠãŒæ¿ƒã„ã€‚",{ wild:false })
        ),
        makePrompt("è¦‹ä¸Šã’ãŸã„ã®ã¯ï¼Ÿ",
          makeOpt("ğŸªŸ","å¤§ãã„çª“","å¤–ãŒå…¥ã‚‹ã€‚",{ wild:false }),
          makeOpt("ğŸ”­","æœ›é é¡","é ããŒè¿‘ã„ã€‚",{ wild:false })
        ),
        makePrompt("éŸ³ã®ç¨®é¡ã¯ï¼Ÿ",
          makeOpt("ğŸ¶","éŸ³æ¥½ã®é“","ãƒªã‚ºãƒ ãŒå‡ºã‚‹ã€‚",{ wild:false }),
          makeOpt("ğŸ¤«","ã—ãƒ¼ã®é“","å£°ãŒå°ã•ã„ã€‚",{ wild:false })
        ),
        makePrompt("è¶³è·¡ã‚’æ®‹ã™ãªã‚‰ï¼Ÿ",
          makeOpt("ğŸ‘£","ç ‚ã®é“","ã™ãæ¶ˆãˆã‚‹ã€‚",{ wild:true }),
          makeOpt("ğŸ§±","çŸ³ã®é“","é•·ãæ®‹ã‚‹ã€‚",{ wild:true })
        ),
        makePrompt("æœ€å¾Œã«å¯„ã‚ŠãŸã„ã®ã¯ï¼Ÿ",
          makeOpt("ğŸ ","ãŠã†ã¡","å®‰å¿ƒãŒæˆ»ã‚‹ã€‚",{ wild:false }),
          makeOpt("ğŸŒ ","æµã‚Œæ˜Ÿã‚¹ãƒãƒƒãƒˆ","é¡˜ã„ãŒå¢—ãˆã‚‹ã€‚",{ wild:false })
        ),
      ],
      style: [
        makePrompt("ã©ã£ã¡ã‚’çºã†ï¼Ÿ",
          makeOpt("âœ¨","ãã‚‰ãã‚‰","ç›®ãŒè¿½ã£ã¦ã—ã¾ã†ã€‚"),
          makeOpt("ğŸª¨","ã—ã¶ã„","å¾Œã‹ã‚‰åŠ¹ãã€‚")
        ),
        makePrompt("æ‰‹è§¦ã‚Šã§é¸ã¶ãªã‚‰ï¼Ÿ",
          makeOpt("ğŸ§£","ãµã‚ãµã‚","è¿‘ã¥ããŸããªã‚‹ã€‚"),
          makeOpt("ğŸ§Š","ã¤ã‚‹ã¤ã‚‹","é›¢ã‚Œã¦è¦‹ãˆã‚‹ã€‚")
        ),
        makePrompt("è‰²ã®æ°—åˆ†ã¯ï¼Ÿ",
          makeOpt("ğŸ©·","ãƒ‘ã‚¹ãƒ†ãƒ«","ã‚„ã‚ã‚‰ã‹ã„è¼ªéƒ­ã€‚"),
          makeOpt("ğŸ–¤","ãƒ¢ãƒã‚¯ãƒ­","è¼ªéƒ­ãŒç«‹ã¤ã€‚")
        ),
        makePrompt("å°ç‰©ã‚’è¶³ã™ãªã‚‰ï¼Ÿ",
          makeOpt("ğŸ€","ãƒªãƒœãƒ³","çµã³ç›®ãŒæ®‹ã‚‹ã€‚"),
          makeOpt("ğŸ©","å¸½å­","å½±ãŒå¢—ãˆã‚‹ã€‚")
        ),
        makePrompt("ç›®å…ƒã®é­”æ³•ã€ã©ã£ã¡ï¼Ÿ",
          makeOpt("ğŸ•¶ï¸","ã‚µãƒ³ã‚°ãƒ©ã‚¹","å¼·ãè¦‹ãˆã‚‹ã€‚"),
          makeOpt("ğŸ‘“","ã‚ãŒã­","è³¢ãè¦‹ãˆã‚‹ã€‚")
        ),
        makePrompt("æ‰‹ã®æ°—åˆ†ã¯ï¼Ÿ",
          makeOpt("ğŸ§¤","æ‰‹è¢‹","ç§˜å¯†ãŒå®ˆã‚Œã‚‹ã€‚"),
          makeOpt("ğŸ«§","ç´ æ‰‹","æ„Ÿã˜ã‚„ã™ã„ã€‚")
        ),
        makePrompt("è¶³å…ƒã¯ï¼Ÿ",
          makeOpt("ğŸ‘Ÿ","ã‚¹ãƒ‹ãƒ¼ã‚«ãƒ¼","è»½ã„éŸ³ã€‚"),
          makeOpt("ğŸ‘¢","ãƒ–ãƒ¼ãƒ„","é‡ã„éŸ³ã€‚")
        ),
        makePrompt("é¦–å…ƒã¯ï¼Ÿ",
          makeOpt("ğŸ“¿","ãŠã¾ã‚‚ã‚Š","ç†ç”±ãŒã‚ã‚‹ã€‚"),
          makeOpt("ğŸ’","ãã‚‰çŸ³","è¨€ã„è¨³ãŒè¦ã‚‰ãªã„ã€‚")
        ),
        makePrompt("é¦™ã‚Šã®æ°—é…ã€ã©ã£ã¡ï¼Ÿ",
          makeOpt("ğŸŒ¸","èŠ±ã®åŒ‚ã„","è¿‘ã„æ˜¥ã€‚"),
          makeOpt("ğŸ‚","æœ¨ã®åŒ‚ã„","é ã„ç§‹ã€‚")
        ),
        makePrompt("é«ªã®æ°—åˆ†ã€ã©ã£ã¡ï¼Ÿ",
          makeOpt("ğŸŒ¬ï¸","ãµã‚ã£ã¨","é¢¨ãŒå…¥ã‚‹ã€‚"),
          makeOpt("ğŸ§·","ãã‚…ã£ã¨","å½¢ãŒä¿ã¦ã‚‹ã€‚")
        ),
        makePrompt("æŒã¡ç‰©ã€ã©ã£ã¡ï¼Ÿ",
          makeOpt("ğŸ‘œ","å°ã•ãªãƒãƒƒã‚°","ç§˜å¯†ãŒå…¥ã‚‹ã€‚"),
          makeOpt("ğŸ’","å¤§ããªãƒãƒƒã‚°","ä¸–ç•ŒãŒå…¥ã‚‹ã€‚")
        ),
        makePrompt("å…‰ã‚’è¶³ã™ãªã‚‰ï¼Ÿ",
          makeOpt("ğŸª„","ãã‚‰ç²‰","èˆã†ã€‚"),
          makeOpt("ğŸ•¯ï¸","ç¯ã‚Š","é™ã‹ã«ç‡ƒãˆã‚‹ã€‚")
        ),
        makePrompt("æ¨¡æ§˜ã¯ï¼Ÿ",
          makeOpt("ğŸŸ¦","ã‚¹ãƒˆãƒ©ã‚¤ãƒ—","é€²ã‚€ã€‚"),
          makeOpt("ğŸŸ£","ãƒ‰ãƒƒãƒˆ","è·³ã­ã‚‹ã€‚")
        ),
        makePrompt("ã‚¢ã‚¯ã‚»ãƒ³ãƒˆã¯ï¼Ÿ",
          makeOpt("ğŸ’","æŒ‡è¼ª","ç´„æŸã£ã½ã„ã€‚"),
          makeOpt("ğŸª™","ã‚³ã‚¤ãƒ³","å†’é™ºã£ã½ã„ã€‚")
        ),
        makePrompt("è€³ã®æ°—åˆ†ã¯ï¼Ÿ",
          makeOpt("ğŸ§","ãƒ˜ãƒƒãƒ‰ãƒ›ãƒ³","ä¸–ç•Œã‚’åˆ‡ã‚‹ã€‚"),
          makeOpt("ğŸµ","ã‚¤ãƒ¤ãƒ›ãƒ³","ä¸–ç•Œã¨æ··ã–ã‚‹ã€‚")
        ),
        makePrompt("æ¸©åº¦ã¯ï¼Ÿ",
          makeOpt("ğŸ”¥","ã‚ã£ãŸã‹","è¿‘ã„ã€‚"),
          makeOpt("â„ï¸","ã²ã‚“ã‚„ã‚Š","æ¾„ã‚€ã€‚")
        ),
        makePrompt("ã¤ã‘è¶³ã™ãªã‚‰ï¼Ÿ",
          makeOpt("ğŸŒŸ","æ˜Ÿã®ãƒãƒƒã‚¸","èª‡ã‚‰ã—ã„ã€‚"),
          makeOpt("ğŸŒ™","æœˆã®ãƒãƒƒã‚¸","æ§ãˆã‚ã€‚")
        ),
        makePrompt("å½±ã®ä½œã‚Šæ–¹ã¯ï¼Ÿ",
          makeOpt("ğŸ§¢","ã¤ã°ã®å½±","é¡”ãŒè¬ã€‚"),
          makeOpt("ğŸ§¥","ã‚³ãƒ¼ãƒˆã®å½±","èº«ä½“ãŒè¬ã€‚")
        ),
        makePrompt("ç´„æŸã®å½¢ã¯ï¼Ÿ",
          makeOpt("ğŸ§·","ãƒ”ãƒ³","ç•™ã‚ã‚‹ã€‚"),
          makeOpt("ğŸª¢","çµã³","ç¶šã‘ã‚‹ã€‚")
        ),
        makePrompt("ä»Šæ—¥ã®ä»•ä¸Šã’ã¯ï¼Ÿ",
          makeOpt("ğŸ«¶","ã‚„ã•ã—ã„","ä¼ã‚ã‚‹ã€‚"),
          makeOpt("ğŸ˜¼","ã¤ã‚ˆã„","å®ˆã‚Œã‚‹ã€‚")
        ),
      ]
    },

    // è‹±èªç‰ˆ
    en: {
      food: [
        makePrompt("Stardust mealâ€”choose one?",
          makeOpt("ğŸ™","Star rice ball","A tight little glow."),
          makeOpt("ğŸ¥","Moon croissant","Soft layers inside.")
        ),
        makePrompt("Warm or cold?",
          makeOpt("ğŸœ","Star ramen","Steam like a spaceship."),
          makeOpt("ğŸ¥—","Quiet salad","Leaves whisper softly.")
        ),
        makePrompt("Quick or slow?",
          makeOpt("ğŸ®","Jelly wobble","Slips right down."),
          makeOpt("ğŸ›","Slow curry","Smells like time.")
        ),
        makePrompt("Pick by color?",
          makeOpt("ğŸš","Pure white rice","Straight and calm."),
          makeOpt("ğŸ","Toasty bread","A little twisty.")
        ),
        makePrompt("A sweet biteâ€”choose?",
          makeOpt("ğŸ«","Night chocolate","Dark comfort."),
          makeOpt("ğŸ“","Morning strawberry","A red sparkle.")
        ),
        makePrompt("Crispy or chewy?",
          makeOpt("ğŸ¥Ÿ","Tiny dumplings","A moon-surface sound."),
          makeOpt("ğŸ¡","Tri-color dango","A palm-sized festival.")
        ),
        makePrompt("Wrapped in soup or baked aroma?",
          makeOpt("ğŸ²","Star soup","Soft floating steam."),
          makeOpt("ğŸ•","Little pizza","Smell arrives first.")
        ),
        makePrompt("A hint of oceanâ€”choose?",
          makeOpt("ğŸ£","Glitter sushi","Angle of waves."),
          makeOpt("ğŸ¦","Fried shrimp","Crumbs like stardust.")
        ),
        makePrompt("Fluffy or crunchy?",
          makeOpt("ğŸ§","Cloud cupcake","Melts fast."),
          makeOpt("ğŸ¥ª","Shadow sandwich","Grows as you chew.")
        ),
        makePrompt("A sweet feelingâ€”choose?",
          makeOpt("ğŸª","Crumbly cookie","A gentle sound."),
          makeOpt("ğŸ§‡","Warm waffle","Happy little grid.")
        ),
        makePrompt("Small happinessâ€”choose?",
          makeOpt("ğŸ§€","One-bite cheese","Quietly rich."),
          makeOpt("ğŸ¯","Honey light","Long, slow drip.")
        ),
        makePrompt("Fruit planetâ€”choose?",
          makeOpt("ğŸ‘","Peach dream","Soft outlines."),
          makeOpt("ğŸ‡","Grape night","Neat little dots.")
        ),
        makePrompt("Pop-pop or moist?",
          makeOpt("ğŸ¿","Space popcorn","Pops loudly."),
          makeOpt("ğŸ°","Soft cake","Settles you down.")
        ),
        makePrompt("Warm wrap or cold clarity?",
          makeOpt("ğŸ¥Ÿ","Steamed charm","White steam."),
          makeOpt("ğŸ¨","Moon ice","Cool blue.")
        ),
        makePrompt("Toastyâ€”choose one?",
          makeOpt("ğŸ¢","Star oden skewer","Steam is talking."),
          makeOpt("ğŸ¥“","Crisp bacon","Sound wins.")
        ),
        makePrompt("A strange drinkâ€”choose?",
          makeOpt("ğŸ§ƒ","Star juice","Bright sweetness."),
          makeOpt("ğŸ«–","Quiet tea","Long aftertaste.")
        ),
        makePrompt("Round or silky?",
          makeOpt("ğŸ™","Little round rice","Warm hands."),
          makeOpt("ğŸ","Silky pasta","Strings stretch.")
        ),
        makePrompt("Add energyâ€”choose?",
          makeOpt("ğŸŒ","Banana light","Works fast."),
          makeOpt("ğŸ¥œ","Nut core","Works later.")
        ),
        makePrompt("Pick by sound?",
          makeOpt("ğŸ¥¨","Crunchy pretzel","Light footsteps."),
          makeOpt("ğŸ","Fluffy bread","Sound disappears.")
        ),
        makePrompt("Last biteâ€”choose?",
          makeOpt("ğŸ¬","Tiny candy","Stays long."),
          makeOpt("ğŸ‹","Sharp lemon","A quick flash.")
        ),
      ],
      out: [
        makePrompt("Which time do you want?",
          makeOpt("ğŸŒ³","Park","Distant sounds.",{ wild:true }),
          makeOpt("ğŸ¬","Cinema","Safe in the dark.",{ wild:false })
        ),
        makePrompt("A detour?",
          makeOpt("ğŸ“š","Bookstore","A forest of spines.",{ wild:false }),
          makeOpt("ğŸ•¹ï¸","Arcade","Strong lights.",{ wild:false })
        ),
        makePrompt("Choose the vibe?",
          makeOpt("ğŸŒŠ","Sea","Borders wobble.",{ wild:true }),
          makeOpt("ğŸ”ï¸","Mountain","Borders feel solid.",{ wild:true })
        ),
        makePrompt("A companion for the way back?",
          makeOpt("ğŸ§ƒ","Juice","Bright sweetness.",{ wild:false }),
          makeOpt("ğŸ¶","Sake","A quiet warmth.",{ wild:false })
        ),
        makePrompt("Look up at the sky?",
          makeOpt("ğŸŒ™","Near the moon","White and still.",{ wild:false }),
          makeOpt("â­","Many-star place","Numbers increase.",{ wild:false })
        ),
        makePrompt("Where does the wind go?",
          makeOpt("ğŸª","Wind square","It pulls you.",{ wild:true }),
          makeOpt("â˜•","Cafe window","You settle.",{ wild:false })
        ),
        makePrompt("Sunlight or shadow?",
          makeOpt("ğŸŒ","Sunny spot","Warm.",{ wild:true }),
          makeOpt("ğŸŒŒ","Star-shadow path","Thin sounds.",{ wild:false })
        ),
        makePrompt("Do you like swaying?",
          makeOpt("ğŸ¡","Ferris wheel","Slow rotation.",{ wild:false }),
          makeOpt("ğŸšƒ","Train","Scenery flows.",{ wild:false })
        ),
        makePrompt("A found thing?",
          makeOpt("ğŸª","Tiny meteor shop","More meaning.",{ wild:false }),
          makeOpt("ğŸ§¸","Plush shop","Easy to hug.",{ wild:false })
        ),
        makePrompt("More noise?",
          makeOpt("ğŸŸï¸","Lively plaza","Laughter bounces.",{ wild:true }),
          makeOpt("ğŸ•¯ï¸","Quiet alley","Only footsteps.",{ wild:false })
        ),
        makePrompt("Stop by water?",
          makeOpt("â›²","Fountain","Sparkles scatter.",{ wild:true }),
          makeOpt("ğŸ›","Warm steam","Melts you.",{ wild:false })
        ),
        makePrompt("Your speed together?",
          makeOpt("ğŸš¶","Slow walk","Thoughts align.",{ wild:true }),
          makeOpt("ğŸƒ","Little run","Laughter first.",{ wild:true })
        ),
        makePrompt("A sky ride?",
          makeOpt("ğŸ›¸","UFO pretend","Feels floating.",{ wild:false }),
          makeOpt("ğŸˆ","Balloon trip","Gets lighter.",{ wild:true })
        ),
        makePrompt("Where does the view change?",
          makeOpt("ğŸ™ï¸","Neon street","More colors.",{ wild:false }),
          makeOpt("ğŸŒ²","Forest gate","More smells.",{ wild:true })
        ),
        makePrompt("A short break?",
          makeOpt("ğŸ¦","Ice cream shop","Cold giggle.",{ wild:false }),
          makeOpt("ğŸ¥Ÿ","Food stall","Hidden by steam.",{ wild:false })
        ),
        makePrompt("Far or near play?",
          makeOpt("ğŸ—ºï¸","Mini trip","More memories.",{ wild:true }),
          makeOpt("ğŸ²","Nearby play","Now becomes dense.",{ wild:false })
        ),
        makePrompt("What do you want to look up at?",
          makeOpt("ğŸªŸ","Big window","Outside comes in.",{ wild:false }),
          makeOpt("ğŸ”­","Telescope","Far becomes near.",{ wild:false })
        ),
        makePrompt("Type of sound?",
          makeOpt("ğŸ¶","Music street","Rhythm appears.",{ wild:false }),
          makeOpt("ğŸ¤«","Shh street","Voices get small.",{ wild:false })
        ),
        makePrompt("Leave footprints?",
          makeOpt("ğŸ‘£","Sand path","Disappears fast.",{ wild:true }),
          makeOpt("ğŸ§±","Stone path","Stays long.",{ wild:true })
        ),
        makePrompt("One last stop?",
          makeOpt("ğŸ ","Home","Safety returns.",{ wild:false }),
          makeOpt("ğŸŒ ","Falling-star spot","Wishes increase.",{ wild:false })
        ),
      ],
      style: [
        makePrompt("What will you wear?",
          makeOpt("âœ¨","Sparkly","Eyes will follow."),
          makeOpt("ğŸª¨","Muted","Hits later.")
        ),
        makePrompt("Choose by texture?",
          makeOpt("ğŸ§£","Fluffy","Makes you come closer."),
          makeOpt("ğŸ§Š","Smooth","Looks cooler from afar.")
        ),
        makePrompt("Color mood?",
          makeOpt("ğŸ©·","Pastel","Soft outlines."),
          makeOpt("ğŸ–¤","Monochrome","Sharp edges.")
        ),
        makePrompt("Add a small item?",
          makeOpt("ğŸ€","Ribbon","A knot remains."),
          makeOpt("ğŸ©","Hat","More shadow.")
        ),
        makePrompt("Eye magic?",
          makeOpt("ğŸ•¶ï¸","Sunglasses","Looks strong."),
          makeOpt("ğŸ‘“","Glasses","Looks smart.")
        ),
        makePrompt("Hands today?",
          makeOpt("ğŸ§¤","Gloves","Secrets stay safe."),
          makeOpt("ğŸ«§","Bare hands","Feels more.")
        ),
        makePrompt("Footsteps?",
          makeOpt("ğŸ‘Ÿ","Sneakers","Light sounds."),
          makeOpt("ğŸ‘¢","Boots","Heavy sounds.")
        ),
        makePrompt("Neck choice?",
          makeOpt("ğŸ“¿","Charm","Has a reason."),
          makeOpt("ğŸ’","Shiny stone","No excuses needed.")
        ),
        makePrompt("A hint of scent?",
          makeOpt("ğŸŒ¸","Flower","Near spring."),
          makeOpt("ğŸ‚","Wood","Far autumn.")
        ),
        makePrompt("Hair mood?",
          makeOpt("ğŸŒ¬ï¸","Soft and airy","Wind comes in."),
          makeOpt("ğŸ§·","Tight and neat","Keeps shape.")
        ),
        makePrompt("Carry what?",
          makeOpt("ğŸ‘œ","Small bag","Holds secrets."),
          makeOpt("ğŸ’","Big bag","Holds a world.")
        ),
        makePrompt("Add some light?",
          makeOpt("ğŸª„","Glitter dust","It dances."),
          makeOpt("ğŸ•¯ï¸","Candle glow","Burns quietly.")
        ),
        makePrompt("Pattern?",
          makeOpt("ğŸŸ¦","Stripes","Moves forward."),
          makeOpt("ğŸŸ£","Dots","Bounces.")
        ),
        makePrompt("Accent?",
          makeOpt("ğŸ’","Ring","Feels like a promise."),
          makeOpt("ğŸª™","Coin","Feels like adventure.")
        ),
        makePrompt("Ears today?",
          makeOpt("ğŸ§","Headphones","Cuts the world."),
          makeOpt("ğŸµ","Earbuds","Mixes with the world.")
        ),
        makePrompt("Temperature?",
          makeOpt("ğŸ”¥","Warm","Closer."),
          makeOpt("â„ï¸","Cool","Clearer.")
        ),
        makePrompt("A badge?",
          makeOpt("ğŸŒŸ","Star badge","Proud."),
          makeOpt("ğŸŒ™","Moon badge","Quiet.")
        ),
        makePrompt("How to make shadow?",
          makeOpt("ğŸ§¢","Brim shadow","Face becomes a mystery."),
          makeOpt("ğŸ§¥","Coat shadow","Body becomes a mystery.")
        ),
        makePrompt("Shape of a promise?",
          makeOpt("ğŸ§·","Pin","Hold it."),
          makeOpt("ğŸª¢","Knot","Continue it.")
        ),
        makePrompt("Final finish today?",
          makeOpt("ğŸ«¶","Gentle","It reaches."),
          makeOpt("ğŸ˜¼","Strong","It protects.")
        ),
      ]
    },

    // ä¸­æ–‡ç‰ˆï¼ˆç®€ä½“ï¼‰
    zh: {
      food: [
        makePrompt("æ˜Ÿå±‘é¥­ï¼Œé€‰å“ªä¸ªï¼Ÿ",
          makeOpt("ğŸ™","æ˜Ÿæ˜Ÿé¥­å›¢","ç´§ç´§å‘å…‰ã€‚"),
          makeOpt("ğŸ¥","æœˆäº®å¯é¢‚","å±‚å±‚è½¯è½¯ã€‚")
        ),
        makePrompt("çƒ­çš„ï¼Ÿå†·çš„ï¼Ÿ",
          makeOpt("ğŸœ","æ˜Ÿæ‹‰é¢","è’¸æ±½åƒé£èˆ¹ã€‚"),
          makeOpt("ğŸ¥—","å®‰é™æ²™æ‹‰","å¶å­åœ¨ä½è¯­ã€‚")
        ),
        makePrompt("å¿«ä¸€ç‚¹ï¼Ÿæ…¢ä¸€ç‚¹ï¼Ÿ",
          makeOpt("ğŸ®","æŠ–æŠ–æœå†»","æ»‘æºœæºœã€‚"),
          makeOpt("ğŸ›","æ…¢æ…¢å’–å–±","æœ‰æ—¶é—´çš„å‘³é“ã€‚")
        ),
        makePrompt("æŒ‰é¢œè‰²é€‰ï¼Ÿ",
          makeOpt("ğŸš","é›ªç™½ç±³é¥­","ç›´ç›´çš„ã€‚"),
          makeOpt("ğŸ","ç„¦é¦™é¢åŒ…","æœ‰ç‚¹æ‹å¼¯ã€‚")
        ),
        makePrompt("ç”œç”œä¸€å£ï¼Œé€‰å“ªä¸ªï¼Ÿ",
          makeOpt("ğŸ«","å¤œä¹‹å·§å…‹åŠ›","é»‘è‰²çš„å®‰å¿ƒã€‚"),
          makeOpt("ğŸ“","æ™¨ä¹‹è‰è“","çº¢è‰²é—ªé—ªã€‚")
        ),
        makePrompt("è„†è„†ï¼Ÿç³¯ç³¯ï¼Ÿ",
          makeOpt("ğŸ¥Ÿ","å°é¥ºå­","åƒæœˆé¢å£°éŸ³ã€‚"),
          makeOpt("ğŸ¡","ä¸‰è‰²å›¢å­","æŒå¿ƒå°ç¥­å…¸ã€‚")
        ),
        makePrompt("æ±¤é‡ŒåŒ…ä½ï¼Ÿçƒ¤å‡ºé¦™å‘³ï¼Ÿ",
          makeOpt("ğŸ²","æ˜Ÿæ˜Ÿæ±¤","è’¸æ±½è½¯è½¯é£˜ã€‚"),
          makeOpt("ğŸ•","å°æŠ«è¨","é¦™å‘³å…ˆåˆ°ã€‚")
        ),
        makePrompt("æµ·çš„æ°”æ¯ï¼Œé€‰å“ªä¸ªï¼Ÿ",
          makeOpt("ğŸ£","é—ªå…‰å¯¿å¸","åƒæµ·æµªè§’åº¦ã€‚"),
          makeOpt("ğŸ¦","ç‚¸è™¾","å¤–è¡£åƒæ˜Ÿå±‘ã€‚")
        ),
        makePrompt("è½¯è½¯ï¼Ÿè„†è„†ï¼Ÿ",
          makeOpt("ğŸ§","äº‘æœµæ¯å­è›‹ç³•","å…¥å£å¾ˆå¿«èã€‚"),
          makeOpt("ğŸ¥ª","å½±å­ä¸‰æ˜æ²»","è¶Šåš¼è¶Šå¤šã€‚")
        ),
        makePrompt("ç”œçš„é¢„æ„Ÿï¼Œé€‰å“ªä¸ªï¼Ÿ",
          makeOpt("ğŸª","é…¥é…¥é¥¼å¹²","å£°éŸ³å¾ˆæ¸©æŸ”ã€‚"),
          makeOpt("ğŸ§‡","çƒ­åå¤«","æ ¼å­å¾ˆå¼€å¿ƒã€‚")
        ),
        makePrompt("å°å°å¹¸ç¦ï¼Œé€‰å“ªä¸ªï¼Ÿ",
          makeOpt("ğŸ§€","ä¸€å£å¥¶é…ª","å®‰é™åœ°æµ“ã€‚"),
          makeOpt("ğŸ¯","èœ‚èœœä¹‹å…‰","æ…¢æ…¢æµå¾ˆä¹…ã€‚")
        ),
        makePrompt("æ°´æœæ˜Ÿçƒï¼Œé€‰å“ªä¸ªï¼Ÿ",
          makeOpt("ğŸ‘","æ¡ƒè‰²çš„æ¢¦","è½®å»“è½¯è½¯ã€‚"),
          makeOpt("ğŸ‡","è‘¡è„ä¹‹å¤œ","å°ç‚¹ç‚¹æ’é˜Ÿã€‚")
        ),
        makePrompt("å™¼å•ªï¼Ÿæ¹¿æ¶¦ï¼Ÿ",
          makeOpt("ğŸ¿","å®‡å®™çˆ†ç±³èŠ±","å•ªåœ°ç‚¸å¼€ã€‚"),
          makeOpt("ğŸ°","æŸ”è½¯è›‹ç³•","è®©äººå®‰å®šã€‚")
        ),
        makePrompt("æ¸©æš–åŒ…ä½ï¼Ÿå†·é™æ¸…æ¾ˆï¼Ÿ",
          makeOpt("ğŸ¥Ÿ","è’¸æ±½å°å’’è¯­","ç™½ç™½çƒ­æ°”ã€‚"),
          makeOpt("ğŸ¨","æœˆäº®å†°æ·‡æ·‹","å†·å†·çš„è“ã€‚")
        ),
        makePrompt("é¦™é¦™çš„ï¼Œé€‰å“ªä¸ªï¼Ÿ",
          makeOpt("ğŸ¢","æ˜Ÿä¹‹å…³ä¸œç…®ä¸²","è’¸æ±½åœ¨èŠå¤©ã€‚"),
          makeOpt("ğŸ¥“","è„†åŸ¹æ ¹","å£°éŸ³æ›´å¼ºã€‚")
        ),
        makePrompt("å¥‡å¦™é¥®æ–™ï¼Œé€‰å“ªä¸ªï¼Ÿ",
          makeOpt("ğŸ§ƒ","æ˜Ÿæœæ±","äº®äº®çš„ç”œã€‚"),
          makeOpt("ğŸ«–","å®‰é™çº¢èŒ¶","ä½™å‘³å¾ˆé•¿ã€‚")
        ),
        makePrompt("åœ†åœ†ï¼Ÿæ»‘æ»‘ï¼Ÿ",
          makeOpt("ğŸ™","å°åœ†é¥­å›¢","æ‰‹å¿ƒçš„æ¸©åº¦ã€‚"),
          makeOpt("ğŸ","é¡ºæ»‘æ„é¢","æ‹‰å‡ºç»†ä¸ã€‚")
        ),
        makePrompt("è¡¥å……èƒ½é‡ï¼Œé€‰å“ªä¸ªï¼Ÿ",
          makeOpt("ğŸŒ","é¦™è•‰ä¹‹å…‰","ç«‹åˆ»è§æ•ˆã€‚"),
          makeOpt("ğŸ¥œ","åšæœä¹‹èŠ¯","ç¨åè§æ•ˆã€‚")
        ),
        makePrompt("æŒ‰å£°éŸ³é€‰ï¼Ÿ",
          makeOpt("ğŸ¥¨","å’”åš“è„†é¥¼","åƒè½»è„šæ­¥ã€‚"),
          makeOpt("ğŸ","è½¯é¢åŒ…","å£°éŸ³æ¶ˆå¤±ã€‚")
        ),
        makePrompt("æœ€åä¸€å£ï¼Œé€‰å“ªä¸ªï¼Ÿ",
          makeOpt("ğŸ¬","å°ç³–","ç•™å¾—å¾ˆä¹…ã€‚"),
          makeOpt("ğŸ‹","é…¸æŸ æª¬","ä¸€ç¬å¾ˆäº®ã€‚")
        ),
      ],
      out: [
        makePrompt("æƒ³è¦å“ªç§æ—¶é—´ï¼Ÿ",
          makeOpt("ğŸŒ³","å…¬å›­","è¿œå¤„æœ‰å£°éŸ³ã€‚",{ wild:true }),
          makeOpt("ğŸ¬","ç”µå½±é™¢","é»‘æš—ä¹Ÿå®‰å¿ƒã€‚",{ wild:false })
        ),
        makePrompt("è¦ä¸è¦ç»•è·¯ï¼Ÿ",
          makeOpt("ğŸ“š","ä¹¦åº—","ä¹¦è„Šåƒæ£®æ—ã€‚",{ wild:false }),
          makeOpt("ğŸ•¹ï¸","æ¸¸æˆå…","å…‰å¾ˆå¼ºã€‚",{ wild:false })
        ),
        makePrompt("é€‰ä¸€ç§æ°”æ¯ï¼Ÿ",
          makeOpt("ğŸŒŠ","æµ·è¾¹","è¾¹ç•Œä¼šæ‘‡æ™ƒã€‚",{ wild:true }),
          makeOpt("ğŸ”ï¸","å±±é‡Œ","è¾¹ç•Œå¾ˆåšå›ºã€‚",{ wild:true })
        ),
        makePrompt("å›å®¶è·¯ä¸Šçš„ä¼™ä¼´ï¼Ÿ",
          makeOpt("ğŸ§ƒ","æœæ±","äº®äº®çš„ç”œã€‚",{ wild:false }),
          makeOpt("ğŸ¶","é…’","å®‰é™çš„çƒ­ã€‚",{ wild:false })
        ),
        makePrompt("æŠ¬å¤´çœ‹å¤©ç©ºï¼Ÿ",
          makeOpt("ğŸŒ™","é è¿‘æœˆäº®","ç™½ç™½é™é™ã€‚",{ wild:false }),
          makeOpt("â­","æ˜Ÿæ˜Ÿå¾ˆå¤šçš„åœ°æ–¹","æ•°é‡å˜å¤šã€‚",{ wild:false })
        ),
        makePrompt("é£å¾€å“ªè¾¹ï¼Ÿ",
          makeOpt("ğŸª","é£çš„å¹¿åœº","ä¼šè¢«æ‹‰èµ°ã€‚",{ wild:true }),
          makeOpt("â˜•","å’–å•¡çª—è¾¹","ä¼šå®‰å®šã€‚",{ wild:false })
        ),
        makePrompt("æ™’å…‰ï¼Ÿèµ°å½±å­ï¼Ÿ",
          makeOpt("ğŸŒ","é˜³å…‰åœ°","æš–æš–çš„ã€‚",{ wild:true }),
          makeOpt("ğŸŒŒ","æ˜Ÿå½±å°è·¯","å£°éŸ³å¾ˆç»†ã€‚",{ wild:false })
        ),
        makePrompt("å–œæ¬¢æ‘‡æ‘‡æ™ƒæ™ƒå—ï¼Ÿ",
          makeOpt("ğŸ¡","æ‘©å¤©è½®","æ…¢æ…¢è½¬ã€‚",{ wild:false }),
          makeOpt("ğŸšƒ","ç”µè½¦","æ™¯è‰²æµåŠ¨ã€‚",{ wild:false })
        ),
        makePrompt("æƒ³æ‰¾ä»€ä¹ˆï¼Ÿ",
          makeOpt("ğŸª","å°é™¨çŸ³åº—","æ„ä¹‰å˜å¤šã€‚",{ wild:false }),
          makeOpt("ğŸ§¸","ç©å¶åº—","å¾ˆå¥½æŠ±ã€‚",{ wild:false })
        ),
        makePrompt("å“ªé‡Œæ›´åµï¼Ÿ",
          makeOpt("ğŸŸï¸","çƒ­é—¹å¹¿åœº","ç¬‘å£°è·³æ¥è·³å»ã€‚",{ wild:true }),
          makeOpt("ğŸ•¯ï¸","å®‰é™å°å··","åªæœ‰è„šæ­¥å£°ã€‚",{ wild:false })
        ),
        makePrompt("è¦é è¿‘æ°´å—ï¼Ÿ",
          makeOpt("â›²","å–·æ³‰","äº®æ™¶æ™¶æ•£å¼€ã€‚",{ wild:true }),
          makeOpt("ğŸ›","çƒ­æ°”","æ…¢æ…¢èåŒ–ã€‚",{ wild:false })
        ),
        makePrompt("ä½ ä»¬çš„é€Ÿåº¦ï¼Ÿ",
          makeOpt("ğŸš¶","æ…¢æ…¢æ•£æ­¥","æƒ³æ³•å¹¶æ’èµ°ã€‚",{ wild:true }),
          makeOpt("ğŸƒ","å°è·‘ä¸€ä¸‹","ç¬‘å£°å…ˆåˆ°ã€‚",{ wild:true })
        ),
        makePrompt("å¤©ç©ºäº¤é€šå·¥å…·ï¼Ÿ",
          makeOpt("ğŸ›¸","æ‰®æ¼”UFO","åƒåœ¨æ¼‚æµ®ã€‚",{ wild:false }),
          makeOpt("ğŸˆ","æ°”çƒæ—…è¡Œ","å˜è½»äº†ã€‚",{ wild:true })
        ),
        makePrompt("å“ªé‡Œæ™¯è‰²ä¼šå˜ï¼Ÿ",
          makeOpt("ğŸ™ï¸","éœ“è™¹è¡—","é¢œè‰²æ›´å¤šã€‚",{ wild:false }),
          makeOpt("ğŸŒ²","æ£®æ—å…¥å£","æ°”å‘³æ›´å¤šã€‚",{ wild:true })
        ),
        makePrompt("ä¼‘æ¯ä¸€ä¸‹ï¼Ÿ",
          makeOpt("ğŸ¦","å†°æ·‡æ·‹åº—","å†·å†·åœ°ç¬‘ã€‚",{ wild:false }),
          makeOpt("ğŸ¥Ÿ","å°æ‘Š","è¢«çƒ­æ°”é®ä½ã€‚",{ wild:false })
        ),
        makePrompt("å»è¿œä¸€ç‚¹ï¼Ÿåœ¨é™„è¿‘ç©ï¼Ÿ",
          makeOpt("ğŸ—ºï¸","å°æ—…è¡Œ","å›å¿†æ›´å¤šã€‚",{ wild:true }),
          makeOpt("ğŸ²","é™„è¿‘ç©","å½“ä¸‹æ›´æµ“ã€‚",{ wild:false })
        ),
        makePrompt("æƒ³æŠ¬å¤´çœ‹ä»€ä¹ˆï¼Ÿ",
          makeOpt("ğŸªŸ","å¤§çª—æˆ·","å¤–é¢è¿›æ¥ã€‚",{ wild:false }),
          makeOpt("ğŸ”­","æœ›è¿œé•œ","è¿œçš„å˜è¿‘ã€‚",{ wild:false })
        ),
        makePrompt("å£°éŸ³çš„ç§ç±»ï¼Ÿ",
          makeOpt("ğŸ¶","éŸ³ä¹ä¹‹è·¯","æœ‰èŠ‚å¥ã€‚",{ wild:false }),
          makeOpt("ğŸ¤«","å˜˜ä¹‹è·¯","å£°éŸ³å˜å°ã€‚",{ wild:false })
        ),
        makePrompt("è¦ç•™ä¸‹è„šå°å—ï¼Ÿ",
          makeOpt("ğŸ‘£","æ²™è·¯","å¾ˆå¿«æ¶ˆå¤±ã€‚",{ wild:true }),
          makeOpt("ğŸ§±","çŸ³è·¯","ç•™å¾—å¾ˆä¹…ã€‚",{ wild:true })
        ),
        makePrompt("æœ€åæƒ³å»å“ªé‡Œï¼Ÿ",
          makeOpt("ğŸ ","å›å®¶","å®‰å¿ƒå›æ¥ã€‚",{ wild:false }),
          makeOpt("ğŸŒ ","æµæ˜Ÿç‚¹","æ„¿æœ›å˜å¤šã€‚",{ wild:false })
        ),
      ],
      style: [
        makePrompt("ç©¿å“ªä¸€ç§ï¼Ÿ",
          makeOpt("âœ¨","é—ªé—ª","çœ¼ç›ä¼šè¿½ç€çœ‹ã€‚"),
          makeOpt("ğŸª¨","ä½è°ƒ","ååŠ²æ›´å¼ºã€‚")
        ),
        makePrompt("æŒ‰è§¦æ„Ÿé€‰ï¼Ÿ",
          makeOpt("ğŸ§£","è½¯è½¯","è®©äººæƒ³é è¿‘ã€‚"),
          makeOpt("ğŸ§Š","æ»‘æ»‘","è¿œçœ‹æ›´å†·é™ã€‚")
        ),
        makePrompt("é¢œè‰²å¿ƒæƒ…ï¼Ÿ",
          makeOpt("ğŸ©·","ç²‰å½©","è½®å»“è½¯è½¯ã€‚"),
          makeOpt("ğŸ–¤","é»‘ç™½","è½®å»“æ›´æ¸…æ™°ã€‚")
        ),
        makePrompt("åŠ ä¸ªå°é…ä»¶ï¼Ÿ",
          makeOpt("ğŸ€","è´è¶ç»“","ç»“ä¼šç•™ä¸‹ã€‚"),
          makeOpt("ğŸ©","å¸½å­","å½±å­æ›´å¤šã€‚")
        ),
        makePrompt("çœ¼ç›çš„é­”æ³•ï¼Ÿ",
          makeOpt("ğŸ•¶ï¸","å¢¨é•œ","çœ‹èµ·æ¥æ›´å¼ºã€‚"),
          makeOpt("ğŸ‘“","çœ¼é•œ","çœ‹èµ·æ¥æ›´èªæ˜ã€‚")
        ),
        makePrompt("æ‰‹çš„å¿ƒæƒ…ï¼Ÿ",
          makeOpt("ğŸ§¤","æ‰‹å¥—","èƒ½å®ˆä½ç§˜å¯†ã€‚"),
          makeOpt("ğŸ«§","å¾’æ‰‹","æ›´å®¹æ˜“æ„Ÿå—ã€‚")
        ),
        makePrompt("è„šæ­¥å£°ï¼Ÿ",
          makeOpt("ğŸ‘Ÿ","è¿åŠ¨é‹","å£°éŸ³è½»ã€‚"),
          makeOpt("ğŸ‘¢","é´å­","å£°éŸ³é‡ã€‚")
        ),
        makePrompt("è„–å­é‚£é‡Œï¼Ÿ",
          makeOpt("ğŸ“¿","æŠ¤èº«ç¬¦","æœ‰ç†ç”±ã€‚"),
          makeOpt("ğŸ’","é—ªçŸ³","ä¸éœ€è¦è§£é‡Šã€‚")
        ),
        makePrompt("æ°”å‘³çš„æ„Ÿè§‰ï¼Ÿ",
          makeOpt("ğŸŒ¸","èŠ±é¦™","è¿‘ä¸€ç‚¹çš„æ˜¥å¤©ã€‚"),
          makeOpt("ğŸ‚","æœ¨é¦™","è¿œä¸€ç‚¹çš„ç§‹å¤©ã€‚")
        ),
        makePrompt("å¤´å‘çš„å¿ƒæƒ…ï¼Ÿ",
          makeOpt("ğŸŒ¬ï¸","æ¾æ¾çš„","é£ä¼šè¿›æ¥ã€‚"),
          makeOpt("ğŸ§·","ç´§ç´§çš„","å½¢çŠ¶èƒ½ä¿æŒã€‚")
        ),
        makePrompt("å¸¦ä»€ä¹ˆï¼Ÿ",
          makeOpt("ğŸ‘œ","å°åŒ…","è£…ç§˜å¯†ã€‚"),
          makeOpt("ğŸ’","å¤§åŒ…","è£…ä¸–ç•Œã€‚")
        ),
        makePrompt("åŠ ä¸€ç‚¹å…‰ï¼Ÿ",
          makeOpt("ğŸª„","äº®ç²‰","ä¼šé£˜èˆã€‚"),
          makeOpt("ğŸ•¯ï¸","çƒ›å…‰","å®‰é™åœ°ç‡ƒã€‚")
        ),
        makePrompt("å›¾æ¡ˆï¼Ÿ",
          makeOpt("ğŸŸ¦","æ¡çº¹","å‘å‰èµ°ã€‚"),
          makeOpt("ğŸŸ£","åœ†ç‚¹","ä¼šè·³ã€‚")
        ),
        makePrompt("å°é‡ç‚¹ï¼Ÿ",
          makeOpt("ğŸ’","æˆ’æŒ‡","åƒçº¦å®šã€‚"),
          makeOpt("ğŸª™","ç¡¬å¸","åƒå†’é™©ã€‚")
        ),
        makePrompt("è€³æœµçš„é€‰æ‹©ï¼Ÿ",
          makeOpt("ğŸ§","å¤§è€³æœº","åˆ‡å¼€ä¸–ç•Œã€‚"),
          makeOpt("ğŸµ","å°è€³æœº","å’Œä¸–ç•Œæ··åœ¨ä¸€èµ·ã€‚")
        ),
        makePrompt("æ¸©åº¦ï¼Ÿ",
          makeOpt("ğŸ”¥","æš–æš–","æ›´é è¿‘ã€‚"),
          makeOpt("â„ï¸","å‡‰å‡‰","æ›´æ¸…æ¾ˆã€‚")
        ),
        makePrompt("åŠ ä¸ªå¾½ç« ï¼Ÿ",
          makeOpt("ğŸŒŸ","æ˜Ÿå¾½ç« ","æœ‰ç‚¹éª„å‚²ã€‚"),
          makeOpt("ğŸŒ™","æœˆå¾½ç« ","æœ‰ç‚¹å®‰é™ã€‚")
        ),
        makePrompt("å½±å­æ€ä¹ˆåšï¼Ÿ",
          makeOpt("ğŸ§¢","å¸½æªå½±å­","è„¸å˜ç¥ç§˜ã€‚"),
          makeOpt("ğŸ§¥","å¤–å¥—å½±å­","èº«ä½“å˜ç¥ç§˜ã€‚")
        ),
        makePrompt("çº¦å®šçš„å½¢çŠ¶ï¼Ÿ",
          makeOpt("ğŸ§·","åˆ«é’ˆ","å›ºå®šä½ã€‚"),
          makeOpt("ğŸª¢","æ‰“ç»“","ç»§ç»­ä¸‹å»ã€‚")
        ),
        makePrompt("ä»Šå¤©æœ€åçš„å®Œæˆï¼Ÿ",
          makeOpt("ğŸ«¶","æ¸©æŸ”","æ›´èƒ½ä¼ è¾¾ã€‚"),
          makeOpt("ğŸ˜¼","å¼ºä¸€ç‚¹","æ›´èƒ½ä¿æŠ¤ã€‚")
        ),
      ]
    }
  };

  const el = (id) => document.getElementById(id);

  const ui = {
    subline: el("subline"),
    heartFill: el("heartFill"),

    sitterToggle: el("sitterToggle"),
    txtSitter: el("txtSitter"),

    stageHint: el("stageHint"),
    stageNote: el("stageNote"),

    macaronArea: el("macaronArea"),
    macaronImg: el("macaronImg"),

    charArea: el("charArea"),
    charImg: el("charImg"),

    thanksOverlay: el("thanksOverlay"),
    txtThanks: el("txtThanks"),

    poop1: el("poop1"),
    poop2: el("poop2"),
    poop3: el("poop3"),

    btnFood: el("btnFood"),
    btnOut: el("btnOut"),
    btnStyle: el("btnStyle"),
    btnClean: el("btnClean"),
    btnDrink: el("btnDrink"),
    btnMacaron: el("btnMacaron"),
    btnShare: el("btnShare"),
    btnLogs: el("btnLogs"),
    btnName: el("btnName"),
    btnReset: el("btnReset"),

    assetHint: el("assetHint"),
    txtMiniInfo: el("txtMiniInfo"),

    liveLog: el("liveLog"),

    modalBack: el("modalBack"),
    modalTitle: el("modalTitle"),
    modalHint: el("modalHint"),
    modalBody: el("modalBody"),
    modalFoot: el("modalFoot"),
    modalX: el("modalX"),

    screenGame: el("screenGame"),
    screenObserve: el("screenObserve"),
    txtObserveHeader: el("txtObserveHeader"),
    txtObserveHint: el("txtObserveHint"),
    obsTitle: el("obsTitle"),
    obsSub: el("obsSub"),
    obsDays: el("obsDays"),
    btnBackToGame: el("btnBackToGame"),
    heartChart: el("heartChart"),

    letterSlot: el("letterSlot"),
    letterBtn: el("letterBtn"),
    letterModal: el("letterModal"),
    letterText: el("letterText"),
    letterClose: el("letterClose"),
    letterX: el("letterX"),

    langSel: el("langSel"),
    txtLangLabel: el("txtLangLabel"),

    txtGameTitle: el("txtGameTitle"),
    txtStageHeader: el("txtStageHeader"),
    txtCareHeader: el("txtCareHeader"),
    txtCareHint: el("txtCareHint"),
    txtLetterBtn: el("txtLetterBtn"),
    txtLetterTitle: el("txtLetterTitle"),
    txtObserveHeader: el("txtObserveHeader"),
    txtObserveHint: el("txtObserveHint")
  };

  function applyLangToUI(){
    document.documentElement.lang = LANG;
    document.title = t("docTitle");

    ui.txtGameTitle.textContent = t("gameTitle");
    ui.txtLangLabel.textContent = t("langLabel");
    ui.txtSitter.textContent = t("sitter");

    ui.txtStageHeader.textContent = t("stageHeader");
    ui.txtCareHeader.textContent = t("careHeader");
    ui.txtCareHint.textContent = t("careHint");

    ui.txtLetterBtn.textContent = t("letter");
    ui.txtLetterTitle.textContent = t("letter");

    ui.txtObserveHeader.textContent = t("observeHeader");
    ui.txtObserveHint.textContent = t("observeHint");

    ui.btnShare.textContent = t("btnShare");
    ui.btnLogs.textContent = t("btnLogs");
    ui.btnName.textContent = t("btnName");
    ui.btnReset.textContent = t("btnReset");

    ui.btnFood.textContent = `ğŸ½ ${t("btnFood")}`;
    ui.btnOut.textContent = `ğŸš€ ${t("btnOut")}`;
    ui.btnStyle.textContent = `âœ¨ ${t("btnStyle")}`;
    ui.btnClean.textContent = `ğŸ§¼ ${t("btnClean")}`;
    ui.btnDrink.textContent = `ğŸ¥¤ ${t("btnDrink")}`;
    ui.btnMacaron.textContent = `ğŸ¬ ${t("btnMacaron")}`;

    ui.modalX.textContent = t("btnClose");
    ui.letterX.textContent = t("btnClose");
    ui.letterClose.textContent = t("btnClose");

    ui.txtThanks.textContent = t("thanks");
    ui.txtMiniInfo.textContent = t("miniInfo");

    ui.assetHint.textContent = `${t("assetHint")}: ${ASSET_BASE}ï¼ˆä¾‹: ${ASSET_BASE}blue_sleep.pngï¼‰`;

    ui.letterText.textContent = getLetterBody();
  }

  function clamp(v, a, b){ return Math.max(a, Math.min(b, v)); }
  function now(){ return Date.now(); }
  function safeJsonParse(s){ try{ return JSON.parse(s); }catch(_){ return null; } }

  function uid(){
    try{
      const a = new Uint32Array(4);
      crypto.getRandomValues(a);
      return [...a].map(x => x.toString(16).padStart(8,"0")).join("");
    }catch(_){
      return "id_" + Math.random().toString(16).slice(2) + "_" + now().toString(16);
    }
  }

  function normalizeName(s){
    const tt = String(s || "").trim();
    if(!tt) return "";
    return tt.replace(/[\r\n\t]/g, "").slice(0, 12);
  }

  function loadSave(){
    const raw = localStorage.getItem(SAVE_KEY);
    if(!raw) return null;
    const obj = safeJsonParse(raw);
    if(!obj || obj.version !== 1) return null;
    normalizeSave(obj);
    return obj;
  }
  function saveSave(obj){ localStorage.setItem(SAVE_KEY, JSON.stringify(obj)); }

  function loadArchives(){
    const raw = localStorage.getItem(ARCHIVE_KEY);
    const arr = raw ? safeJsonParse(raw) : null;
    return Array.isArray(arr) ? arr : [];
  }
  function saveArchives(arr){ localStorage.setItem(ARCHIVE_KEY, JSON.stringify(arr)); }

  function assetPath(file){ return ASSET_BASE + file; }

  function calcElapsedMs(save, tNow){
    const baseNow = save.pausedSince ? save.pausedSince : tNow;
    return Math.max(0, baseNow - save.startedAt - save.totalPausedMs);
  }

  function dayIndex(elapsed){
    return clamp(Math.floor(elapsed / DAY_MS) + 1, 1, 3);
  }

  function ensureDay(save, d){
    if(!save.days) save.days = {};
    if(!save.days[d]){
      save.days[d] = {
        day: d,
        careCounts: { food:0, out:0, style:0, clean:0 },
        choices: [],
        heartChange: 0,
        sitterMs: 0,
        items: { drink:0, macaron:0 },
        heartStart: save.heart,
        heartEnd: save.heart
      };
    }else{
      const dd = save.days[d];
      if(!dd.careCounts) dd.careCounts = { food:0, out:0, style:0, clean:0 };
      dd.careCounts.food = dd.careCounts.food ?? 0;
      dd.careCounts.out = dd.careCounts.out ?? 0;
      dd.careCounts.clean = dd.careCounts.clean ?? 0;
      dd.careCounts.style = dd.careCounts.style ?? 0;
      if(!Array.isArray(dd.choices)) dd.choices = [];
      if(!dd.items) dd.items = { drink:0, macaron:0 };
      dd.items.drink = dd.items.drink ?? 0;
      dd.items.macaron = dd.items.macaron ?? 0;
      dd.heartChange = dd.heartChange ?? 0;
      dd.sitterMs = dd.sitterMs ?? 0;
      dd.heartStart = dd.heartStart ?? save.heart;
      dd.heartEnd = dd.heartEnd ?? save.heart;
    }
    return save.days[d];
  }

  function normalizeSave(save){
    save.totalPausedMs = save.totalPausedMs ?? 0;
    save.pausedSince = save.pausedSince ?? null;

    save.lifeExtensionMs = save.lifeExtensionMs ?? 0;

    save.petName = save.petName ?? "";

    save.heart = clamp(save.heart ?? 50, 0, 100);
    save.hunger = clamp(save.hunger ?? 20, 0, 100);
    save.dirt = clamp(save.dirt ?? 10, 0, 100);
    save.mood = clamp(save.mood ?? 70, 0, 100);
    save.poop = clamp(save.poop ?? 0, 0, 3);

    save.lastSimElapsed = save.lastSimElapsed ?? 0;
    save.currentDay = save.currentDay ?? 1;

    save.sleepUntilElapsed = save.sleepUntilElapsed ?? null;
    save.lastSleepAtElapsed = save.lastSleepAtElapsed ?? 0;

    if(!Array.isArray(save.live)) save.live = [];
    if(!save.days) save.days = {};
    ensureDay(save, 1);

    save.bags = save.bags ?? { food:[], out:[], style:[] };
    save.bags.food = Array.isArray(save.bags.food) ? save.bags.food : [];
    save.bags.out = Array.isArray(save.bags.out) ? save.bags.out : [];
    save.bags.style = Array.isArray(save.bags.style) ? save.bags.style : [];
  }

  function pushLiveLog(save, text){
    if(!save.live) save.live = [];
    const stamp = now();
    save.live.unshift({ t: stamp, text });
    if(save.live.length > 30) save.live.length = 30;
  }

  function formatClock(t2){
    const d = new Date(t2);
    const hh = String(d.getHours()).padStart(2,"0");
    const mm = String(d.getMinutes()).padStart(2,"0");
    return `${hh}:${mm}`;
  }

  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, m => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
    }[m]));
  }

  function addChoice(save, category, choiceLabel){
    const d = ensureDay(save, save.currentDay);
    d.choices.push({ t: now(), category, choice: choiceLabel });
  }

  function applyHeart(save, delta){
    const d = ensureDay(save, save.currentDay);
    const before = save.heart;
    save.heart = clamp(save.heart + delta, 0, 100);
    const realDelta = save.heart - before;
    d.heartChange += realDelta;
    d.heartEnd = save.heart;
  }

  function heartDeltaRandom(){
    const r = Math.random();
    if(r < 0.15) return -2;
    if(r < 0.50) return 0;
    if(r < 0.85) return 2;
    return 3;
  }

  function createNewSave(){
    const t0 = now();
    const playerId = uid();

    const macaronColor = COLORS[Math.floor(Math.random() * COLORS.length)];
    const charColor = macaronColor;

    const s = {
      version: 1,
      playerId,
      startedAt: t0,
      totalPausedMs: 0,
      pausedSince: null,

      macaronColor,
      charColor,

      petName: "",

      hatched: false,
      hatchAnim: false,

      ended: false,
      endedAt: null,

      macaronActive: false,
      macaronEndsAtElapsed: null,

      lifeExtensionMs: 0,

      heart: 50,
      hunger: 20,
      dirt: 10,
      mood: 70,
      poop: 0,

      sleepUntilElapsed: null,
      lastSleepAtElapsed: 0,

      lastSimElapsed: 0,
      currentDay: 1,

      bags: { food:[], out:[], style:[] },

      days: {},
      live: []
    };

    ensureDay(s, 1);
    pushLiveLog(s, t("logArrived"));
    return s;
  }

  function isAlive(save, elapsed){
    const deadline = LIFE_MS + (save.lifeExtensionMs || 0);
    if(save.macaronActive) return true;
    return (elapsed < deadline) && !save.ended;
  }

  function canInteract(save, elapsed){
    if(save.pausedSince) return true;
    if(save.macaronActive) return true;
    if(save.ended) return false;
    if(!save.hatched) return false;
    return isAlive(save, elapsed);
  }

  function updatePoop(save){
    const desired = clamp(Math.floor((save.dirt - 50) / 20), 0, 3);
    save.poop = Math.max(save.poop, desired);
  }

  function isSleeping(save, elapsed){
    if(save.pausedSince) return true;
    if(save.sleepUntilElapsed == null) return false;
    return elapsed < save.sleepUntilElapsed;
  }

  function maybeStartSleep(save, elapsed){
    if(isSleeping(save, elapsed)) return;

    const since = elapsed - (save.lastSleepAtElapsed || 0);
    const cool = FAST ? 7 * 1000 : 4 * 60 * 1000;
    if(since < cool) return;

    save.sleepUntilElapsed = elapsed + SLEEP_MS;
    save.lastSleepAtElapsed = elapsed;

    pushLiveLog(save, t("logQuiet"));
  }

  function applyTimeSimulation(save, elapsed){
    const prev = save.lastSimElapsed || 0;
    const deltaMs = Math.max(0, elapsed - prev);
    if(deltaMs <= 0) return;

    const minutes = deltaMs / 60000;

    save.hunger = clamp(save.hunger + minutes * HUNGER_PER_MIN, 0, 100);
    save.dirt   = clamp(save.dirt   + minutes * DIRT_PER_MIN,   0, 100);

    updatePoop(save);

    let moodDelta = 0;
    const stress =
      (save.hunger > 70 ? (save.hunger - 70) / 30 : 0) +
      (save.dirt   > 70 ? (save.dirt   - 70) / 30 : 0);

    moodDelta -= minutes * 0.35 * stress;
    if(save.poop > 0) moodDelta -= minutes * 0.12 * save.poop;

    if(save.hunger < 35 && save.dirt < 35 && save.poop === 0){
      moodDelta += minutes * 0.10;
    }

    if(isSleeping(save, elapsed)){
      moodDelta += minutes * 0.12;
    }

    save.mood = clamp(save.mood + moodDelta, 0, 100);

    const calm = (save.mood > 72 && save.hunger < 55 && save.dirt < 55 && save.poop === 0);
    if(calm){
      const p = minutes * 0.05;
      if(Math.random() < p){
        maybeStartSleep(save, elapsed);
      }
    }
  }

  function updateDayBoundary(save, elapsed){
    const d = dayIndex(elapsed);
    if(!save.currentDay) save.currentDay = d;

    if(d !== save.currentDay){
      const prev = ensureDay(save, save.currentDay);
      prev.heartEnd = save.heart;
      save.currentDay = d;
      const next = ensureDay(save, d);
      next.heartStart = save.heart;
      pushLiveLog(save, t("logDayChanged"));
    }
    ensureDay(save, save.currentDay);
  }

  function maybeHatch(save, elapsed){
    if(save.hatched) return;
    if(elapsed >= HATCH_MS){
      save.hatchAnim = true;
      setTimeout(() => {
        const s = loadSave();
        if(!s || s.hatched) return;
        s.hatched = true;
        s.hatchAnim = false;
        pushLiveLog(s, t("logHatched"));
        saveSave(s);
      }, 700);
    }
  }

  function archiveRun(save){
    const arr = loadArchives();
    const exp = exportObservationData(save);
    const exist = arr.some(x => x && x.playerId === exp.playerId && x.startedAt === exp.startedAt);
    if(exist) return;
    arr.unshift(exp);
    if(arr.length > 20) arr.length = 20;
    saveArchives(arr);
  }

  function maybeEnd(save, elapsed){
    if(save.macaronActive) return;
    const deadline = LIFE_MS + (save.lifeExtensionMs || 0);
    if(!save.ended && elapsed >= deadline){
      save.ended = true;
      save.endedAt = now();
      pushLiveLog(save, t("logGone"));
      archiveRun(save);
    }
  }

  function updateMacaronTimer(save, elapsed){
    if(!save.macaronActive) return;
    if(save.macaronEndsAtElapsed == null) return;
    if(elapsed >= save.macaronEndsAtElapsed){
      save.macaronActive = false;
      save.macaronEndsAtElapsed = null;
      save.ended = true;
      save.endedAt = now();
      pushLiveLog(save, t("logOff"));
      archiveRun(save);
    }
  }

  function stateClass(save){
    if(save.mood < 25 || save.hunger > 85 || save.dirt > 85 || save.poop >= 3) return "cry";
    if(save.mood < 45 || save.hunger > 70 || save.dirt > 70 || save.poop >= 2) return "low";
    if(save.mood > 70 && save.hunger < 55 && save.dirt < 55 && save.poop === 0) return "lively";
    return "";
  }

  function setInteractable(enabled){
    [ui.btnFood, ui.btnOut, ui.btnStyle, ui.btnClean, ui.btnDrink].forEach(b => b.disabled = !enabled);
  }

  function setImgWithFallback(imgEl, primarySrc, fallbackSrc, fallback2Src){
    imgEl.removeAttribute("data-fallback-used");
    imgEl.removeAttribute("data-fallback2-used");
    imgEl.setAttribute("data-primary", primarySrc);
    imgEl.setAttribute("data-fallback", fallbackSrc || "");
    imgEl.setAttribute("data-fallback2", fallback2Src || "");
    if(imgEl.getAttribute("data-src") !== primarySrc){
      imgEl.setAttribute("data-src", primarySrc);
      imgEl.src = primarySrc;
    }
  }

  function applyVisualImages(save){
    const mc = FILES.macaron[save.macaronColor] ? save.macaronColor : "blue";
    const macaronSrc = assetPath(FILES.macaron[mc]);
    if(ui.macaronImg.getAttribute("data-src") !== macaronSrc){
      ui.macaronImg.setAttribute("data-src", macaronSrc);
      ui.macaronImg.src = macaronSrc;
    }

    const cc = FILES.char[save.charColor] ? save.charColor : "blue";
    const sc = stateClass(save);

    const elapsed = calcElapsedMs(save, now());
    const sleeping = isSleeping(save, elapsed);

    let charFile = FILES.char[cc].closed;
    let fb1 = "";
    let fb2 = "";

    if(sleeping){
      charFile = FILES.char[cc].sleep;
      fb1 = FILES.char[cc].sleepFallback || "";
      fb2 = FILES.char[cc].sleepFallback2 || "";
    }else{
      const wantOpen = (sc === "lively");
      charFile = wantOpen ? FILES.char[cc].open : FILES.char[cc].closed;
    }

    const charSrc = assetPath(charFile);
    const fbSrc1 = fb1 ? assetPath(fb1) : "";
    const fbSrc2 = fb2 ? assetPath(fb2) : "";
    setImgWithFallback(ui.charImg, charSrc, fbSrc1, fbSrc2);
  }

  let letterAutoCloseTimer = null;

  function openLetter(){
    ui.letterModal.classList.remove("closing");
    ui.letterModal.classList.add("open");
    ui.letterModal.setAttribute("aria-hidden","false");

    clearTimeout(letterAutoCloseTimer);
    letterAutoCloseTimer = setTimeout(() => closeLetter(), FAST ? 5000 : 12000);

    const s = loadSave();
    if(s){
      addChoice(s, "Letter", "Read");
      pushLiveLog(s, t("logReadLetter"));
      saveSave(s);
    }
  }

  function closeLetter(){
    if(!ui.letterModal.classList.contains("open")) return;

    clearTimeout(letterAutoCloseTimer);
    ui.letterModal.classList.add("closing");
    setTimeout(() => {
      ui.letterModal.classList.remove("open","closing");
      ui.letterModal.setAttribute("aria-hidden","true");
    }, 240);
  }

  function showLetterSlot(){
    ui.letterSlot.classList.remove("vanish");
    if(!ui.letterSlot.classList.contains("show")){
      ui.letterSlot.classList.add("show");
    }
    if(ui.letterSlot.dataset.dropped !== "1"){
      ui.letterSlot.dataset.dropped = "1";
      ui.letterSlot.classList.add("drop");
      setTimeout(() => ui.letterSlot.classList.remove("drop"), 980);
    }
  }

  function hideLetterSlot(){
    if(!ui.letterSlot.classList.contains("show")) return;
    ui.letterSlot.classList.add("vanish");
    setTimeout(() => {
      ui.letterSlot.classList.remove("show","vanish");
    }, 700);
  }

  function openModal(title, hint, bodyNode, footButtons){
    ui.modalTitle.textContent = title || "";
    ui.modalHint.textContent = hint || "";
    ui.modalBody.innerHTML = "";
    ui.modalBody.appendChild(bodyNode);

    ui.modalFoot.innerHTML = "";
    footButtons.forEach(btn => ui.modalFoot.appendChild(btn));

    ui.modalBack.classList.add("show");
    ui.modalBack.setAttribute("aria-hidden","false");
  }
  function closeModal(){
    ui.modalBack.classList.remove("show");
    ui.modalBack.setAttribute("aria-hidden","true");
  }
  ui.modalX.addEventListener("click", closeModal);
  ui.modalBack.addEventListener("click", (e) => { if(e.target === ui.modalBack) closeModal(); });
  window.addEventListener("keydown", (e) => { if(e.key === "Escape") closeModal(); });

  function mkBtn(text, cls, onClick){
    const b = document.createElement("button");
    b.textContent = text;
    if(cls) b.className = cls;
    b.addEventListener("click", onClick);
    return b;
  }

  function mkChoice(icon, title, sub, onPick){
    const div = document.createElement("div");
    div.className = "choice";
    div.innerHTML = `
      <div class="cTitle"><span class="cIcon">${escapeHtml(icon || "â“")}</span>${escapeHtml(title)}</div>
      <div class="cSub">${escapeHtml(sub)}</div>
    `;
    div.addEventListener("click", onPick);
    return div;
  }

  function shuffleInPlace(a){
    for(let i=a.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [a[i],a[j]] = [a[j],a[i]];
    }
    return a;
  }

  function listForLang(key){
    const pack = TWOCHOICE[LANG] || TWOCHOICE.ja;
    const list = pack[key] || (TWOCHOICE.ja[key] || []);
    return list;
  }

  function pickFromBag(save, key){
    const list = listForLang(key);
    if(!list || !list.length) return null;

    if(!save.bags) save.bags = { food:[], out:[], style:[] };
    if(!Array.isArray(save.bags[key])) save.bags[key] = [];

    // è¨€èªå¤‰æ›´ãªã©ã§é•·ã•ãŒã‚ºãƒ¬ãŸã¨ãã¯è¢‹ã‚’ä½œã‚Šç›´ã™
    if(save.bags[key].some(i => i >= list.length)) save.bags[key] = [];

    if(save.bags[key].length === 0){
      save.bags[key] = shuffleInPlace([...Array(list.length)].map((_,i)=>i));
    }
    const idx = save.bags[key].pop();
    return list[idx];
  }

  function applyAfterChoiceMaybeSleep(save){
    const elapsed = calcElapsedMs(save, now());
    if(Math.random() < 0.18){
      maybeStartSleep(save, elapsed);
    }
  }

  function openNameModal(initial){
    const save = loadSave(); if(!save) return;

    const body = document.createElement("div");

    const story = document.createElement("div");
    story.style.fontSize = "12px";
    story.style.color = "rgba(238,242,255,.78)";
    story.style.lineHeight = "1.85";
    story.style.whiteSpace = "pre-wrap";
    story.style.marginBottom = "10px";
    story.textContent = initial ? getIntroText() : t("nameStoryEdit");

    const input = document.createElement("input");
    input.type = "text";
    input.maxLength = 12;
    input.placeholder = t("namePlaceholder");
    input.value = save.petName || "";
    input.style.width = "100%";
    input.style.padding = "12px 12px";
    input.style.borderRadius = "14px";
    input.style.border = "1px solid rgba(255,255,255,.16)";
    input.style.background = "rgba(255,255,255,.06)";
    input.style.color = "rgba(238,242,255,.95)";
    input.style.outline = "none";

    const note = document.createElement("div");
    note.style.fontSize = "11px";
    note.style.color = "rgba(238,242,255,.62)";
    note.style.lineHeight = "1.7";
    note.style.marginTop = "8px";
    note.textContent = t("nameNote");

    body.appendChild(story);
    body.appendChild(input);
    body.appendChild(note);

    const commit = () => {
      const s = loadSave(); if(!s) return;
      const name = normalizeName(input.value);
      s.petName = name || "ï¼Ÿï¼Ÿï¼Ÿ";
      addChoice(s, "Name", s.petName);
      pushLiveLog(s, `${t("logNamed")}${s.petName}`);
      saveSave(s);
      closeModal();
    };

    input.addEventListener("keydown", (e) => {
      if(e.key === "Enter"){
        e.preventDefault();
        commit();
      }
    });

    openModal(
      t("nameTitle"),
      initial ? t("nameHintInit") : t("nameHintEdit"),
      body,
      [
        mkBtn(t("btnLater"), "btnGhost", closeModal),
        mkBtn(t("btnDecide"), "", commit)
      ]
    );

    setTimeout(() => input.focus(), 0);
  }

  function actFood(){
    const save = loadSave(); if(!save) return;
    const elapsed = calcElapsedMs(save, now());
    if(!canInteract(save, elapsed)) return;

    const p = pickFromBag(save, "food");
    saveSave(save);

    const body = document.createElement("div");
    body.innerHTML = `<div style="font-size:12px;color:rgba(238,242,255,.78);line-height:1.7">
      ${escapeHtml(p.q)}
    </div>`;
    const two = document.createElement("div");
    two.className = "two";

    const pick = (opt) => {
      const s = loadSave(); if(!s) return;
      const e = calcElapsedMs(s, now());
      if(!canInteract(s, e)) return;

      ensureDay(s, s.currentDay).careCounts.food++;
      const label = `${opt.icon} ${opt.t}`;
      addChoice(s, t("btnFood"), label);

      s.hunger = clamp(s.hunger - 21 + (Math.random()*6 - 3), 0, 100);
      s.mood   = clamp(s.mood   +  4 + (Math.random()*6 - 3), 0, 100);

      applyHeart(s, heartDeltaRandom());
      pushLiveLog(s, `${label}${t("chose")}`);

      applyAfterChoiceMaybeSleep(s);

      saveSave(s);
      closeModal();
    };

    two.appendChild(mkChoice(p.a.icon, p.a.t, p.a.sub, () => pick(p.a)));
    two.appendChild(mkChoice(p.b.icon, p.b.t, p.b.sub, () => pick(p.b)));
    body.appendChild(two);

    openModal(t("btnFood"), t("twoChoice"), body, [ mkBtn(t("btnCancel"), "btnGhost", closeModal) ]);
  }

  function actOut(){
    const save = loadSave(); if(!save) return;
    const elapsed = calcElapsedMs(save, now());
    if(!canInteract(save, elapsed)) return;

    const p = pickFromBag(save, "out");
    saveSave(save);

    const body = document.createElement("div");
    body.innerHTML = `<div style="font-size:12px;color:rgba(238,242,255,.78);line-height:1.7">
      ${escapeHtml(p.q)}
    </div>`;
    const two = document.createElement("div");
    two.className = "two";

    const pick = (opt) => {
      const s = loadSave(); if(!s) return;
      const e = calcElapsedMs(s, now());
      if(!canInteract(s, e)) return;

      ensureDay(s, s.currentDay).careCounts.out++;
      const label = `${opt.icon} ${opt.t}`;
      addChoice(s, t("btnOut"), label);

      const wild = !!opt.wild;
      s.mood = clamp(s.mood + (wild ? 10 : 7) + (Math.random()*6 - 3), 0, 100);
      s.dirt = clamp(s.dirt + (wild ?  7 : 4) + (Math.random()*4 - 2), 0, 100);

      applyHeart(s, heartDeltaRandom());
      pushLiveLog(s, `${label}${t("decided")}`);

      applyAfterChoiceMaybeSleep(s);

      saveSave(s);
      closeModal();
    };

    two.appendChild(mkChoice(p.a.icon, p.a.t, p.a.sub, () => pick(p.a)));
    two.appendChild(mkChoice(p.b.icon, p.b.t, p.b.sub, () => pick(p.b)));
    body.appendChild(two);

    openModal(t("btnOut"), t("twoChoice"), body, [ mkBtn(t("btnCancel"), "btnGhost", closeModal) ]);
  }

  function actStyle(){
    const save = loadSave(); if(!save) return;
    const elapsed = calcElapsedMs(save, now());
    if(!canInteract(save, elapsed)) return;

    const p = pickFromBag(save, "style");
    saveSave(save);

    const body = document.createElement("div");
    body.innerHTML = `<div style="font-size:12px;color:rgba(238,242,255,.78);line-height:1.7">
      ${escapeHtml(p.q)}
    </div>`;
    const two = document.createElement("div");
    two.className = "two";

    const pick = (opt) => {
      const s = loadSave(); if(!s) return;
      const e = calcElapsedMs(s, now());
      if(!canInteract(s, e)) return;

      const d = ensureDay(s, s.currentDay);
      d.careCounts.style = (d.careCounts.style ?? 0) + 1;

      const label = `${opt.icon} ${opt.t}`;
      addChoice(s, t("btnStyle"), label);

      s.mood = clamp(s.mood + 8 + (Math.random()*8 - 4), 0, 100);
      s.dirt = clamp(s.dirt + (Math.random()*8 - 4), 0, 100);

      applyHeart(s, heartDeltaRandom());
      pushLiveLog(s, `${label}${t("decided")}`);

      applyAfterChoiceMaybeSleep(s);

      saveSave(s);
      closeModal();
    };

    two.appendChild(mkChoice(p.a.icon, p.a.t, p.a.sub, () => pick(p.a)));
    two.appendChild(mkChoice(p.b.icon, p.b.t, p.b.sub, () => pick(p.b)));
    body.appendChild(two);

    openModal(t("btnStyle"), t("twoChoice"), body, [ mkBtn(t("btnCancel"), "btnGhost", closeModal) ]);
  }

  function actClean(){
    const save = loadSave(); if(!save) return;
    const elapsed = calcElapsedMs(save, now());
    if(!canInteract(save, elapsed)) return;

    const body = document.createElement("div");
    body.innerHTML = `<div style="font-size:12px;color:rgba(238,242,255,.78);line-height:1.7; white-space:pre-wrap">
${escapeHtml(t("cleanHow"))}
    </div>`;

    const two = document.createElement("div");
    two.className = "two";

    const startClean = (modeLabel, careful) => {
      const s0 = loadSave(); if(!s0) return;
      const e0 = calcElapsedMs(s0, now());
      if(!canInteract(s0, e0)) return;

      closeModal();

      const s = loadSave(); if(!s) return;

      const need = Math.max(1, s.poop);
      let remaining = need;

      const overlay = document.createElement("div");
      overlay.style.position = "fixed";
      overlay.style.inset = "0";
      overlay.style.background = "rgba(0,0,0,.55)";
      overlay.style.zIndex = "120";
      overlay.style.display = "grid";
      overlay.style.placeItems = "center";
      overlay.style.padding = "18px";

      const box = document.createElement("div");
      box.style.width = "min(560px, 96vw)";
      box.style.border = "1px solid rgba(255,255,255,.16)";
      box.style.background = "rgba(16,18,34,.88)";
      box.style.borderRadius = "18px";
      box.style.boxShadow = "0 22px 60px rgba(0,0,0,.45)";
      box.style.padding = "12px";
      box.style.backdropFilter = "blur(12px)";

      const head = document.createElement("div");
      head.style.display = "flex";
      head.style.justifyContent = "space-between";
      head.style.gap = "10px";
      head.style.alignItems = "center";

      const left = document.createElement("div");
      left.innerHTML = `
        <div style="font-weight:850;font-size:14px">${escapeHtml(t("btnClean"))}</div>
        <div style="font-size:12px;color:rgba(238,242,255,.72);margin-top:4px">${escapeHtml(t("tapToErase").replace("{n}", String(remaining)))}</div>
      `;
      head.appendChild(left);

      const cancel = mkBtn(t("btnCancel"), "btnGhost", () => { document.body.removeChild(overlay); });
      cancel.style.padding = "8px 10px";
      head.appendChild(cancel);

      const field = document.createElement("div");
      field.style.marginTop = "10px";
      field.style.display = "flex";
      field.style.flexWrap = "wrap";
      field.style.gap = "10px";
      field.style.justifyContent = "center";

      function setRemainText(n){
        left.querySelector("div:nth-child(2)").textContent = t("tapToErase").replace("{n}", String(Math.max(0,n)));
      }

      function mkPoopChip(){
        const chip = document.createElement("div");
        chip.style.width = "64px";
        chip.style.height = "64px";
        chip.style.borderRadius = "18px";
        chip.style.border = "1px solid rgba(255,255,255,.12)";
        chip.style.background = "linear-gradient(180deg, rgba(251,146,60,.92), rgba(234,179,8,.82))";
        chip.style.boxShadow = "0 12px 24px rgba(0,0,0,.25)";
        chip.style.cursor = "pointer";
        chip.style.transform = `rotate(${(Math.random()*18-9).toFixed(1)}deg)`;
        chip.addEventListener("click", () => {
          chip.style.opacity = ".0";
          chip.style.pointerEvents = "none";
          remaining--;
          setRemainText(remaining);

          if(remaining <= 0){
            const s1 = loadSave(); if(!s1) return;
            const e1 = calcElapsedMs(s1, now());
            if(!canInteract(s1, e1)) return;

            ensureDay(s1, s1.currentDay).careCounts.clean++;
            addChoice(s1, t("btnClean"), modeLabel);

            s1.poop = 0;
            s1.dirt = clamp(s1.dirt - (careful ? 26 : 16) + (Math.random()*4 - 2), 0, 100);
            s1.mood = clamp(s1.mood + (careful ? 10 :  6) + (Math.random()*4 - 2), 0, 100);

            applyHeart(s1, heartDeltaRandom());
            pushLiveLog(s1, t("cleaned"));

            applyAfterChoiceMaybeSleep(s1);

            saveSave(s1);
            document.body.removeChild(overlay);
          }
        });
        return chip;
      }

      for(let i=0;i<need;i++) field.appendChild(mkPoopChip());

      const note = document.createElement("div");
      note.style.marginTop = "10px";
      note.style.fontSize = "12px";
      note.style.color = "rgba(238,242,255,.72)";
      note.style.lineHeight = "1.7";
      note.textContent = t("autoBack");

      box.appendChild(head);
      box.appendChild(field);
      box.appendChild(note);
      overlay.appendChild(box);
      document.body.appendChild(overlay);
    };

    const labelCareful = (LANG==="en") ? "Carefully" : (LANG==="zh" ? "è®¤çœŸæ¸…ç†" : "ã¦ã„ã­ã„ã«æƒé™¤");
    const labelQuick   = (LANG==="en") ? "Quickly"   : (LANG==="zh" ? "å¿«é€Ÿæ¸…ç†" : "ã•ã£ã¨æƒé™¤");

    two.appendChild(mkChoice("ğŸ§¼", labelCareful, (LANG==="en"?"Take a little time.":(LANG==="zh"?"ç¨å¾®èŠ±ç‚¹æ—¶é—´ã€‚":"å°‘ã—æ™‚é–“ã‚’ã‹ã‘ã‚‹ã€‚")), () => startClean(labelCareful, true)));
    two.appendChild(mkChoice("ğŸ§»", labelQuick,   (LANG==="en"?"Finish fast.":(LANG==="zh"?"èµ¶å¿«ç»“æŸã€‚":"æ€¥ã„ã§æ¸ˆã¾ã›ã‚‹ã€‚")), () => startClean(labelQuick, false)));
    body.appendChild(two);

    openModal(t("btnClean"), `${t("twoChoice")} + Tap`, body, [ mkBtn(t("btnCancel"), "btnGhost", closeModal) ]);
  }

  function actDrink(){
    const save = loadSave(); if(!save) return;
    if(!save.hatched) return;
    if(save.ended || save.macaronActive) return;

    const body = document.createElement("div");
    body.innerHTML = `<div style="font-size:12px;color:rgba(238,242,255,.78);line-height:1.7; white-space:pre-wrap">
${escapeHtml(t("drinkAsk"))}
    </div>`;

    const two = document.createElement("div");
    two.className = "two";

    const use = () => {
      const s = loadSave(); if(!s) return;
      if(s.ended || s.macaronActive) return;

      const d = ensureDay(s, s.currentDay);
      d.items.drink++;
      addChoice(s, t("btnDrink"), "ğŸ¥¤ " + t("use"));

      s.hunger = clamp(s.hunger - 12 + (Math.random()*4 - 2), 0, 100);
      s.dirt   = clamp(s.dirt   - 10 + (Math.random()*4 - 2), 0, 100);
      s.mood   = clamp(s.mood   +  8 + (Math.random()*4 - 2), 0, 100);

      s.lifeExtensionMs = (s.lifeExtensionMs || 0) + DRINK_EXTEND_MS;
      s.startedAt += DRINK_BACK_MS;

      pushLiveLog(s, t("usedDrink"));

      applyAfterChoiceMaybeSleep(s);

      saveSave(s);
      closeModal();
    };

    two.appendChild(mkChoice("ğŸ¥¤", t("use"), (LANG==="en"?"Just a little.":(LANG==="zh"?"åªæ˜¯ä¸€ç‚¹ç‚¹ã€‚":"ã»ã‚“ã®å°‘ã—ã€‚")), use));
    two.appendChild(mkChoice("ğŸ¤²", t("notUse"), (LANG==="en"?"Maybe later.":(LANG==="zh"?"ä»¥åå†è¯´ã€‚":"ä»Šå›ã¯è¦‹é€ã‚‹ã€‚")), () => {
      const s = loadSave();
      if(s) { addChoice(s, t("btnDrink"), "ğŸ¤² " + t("notUse")); saveSave(s); }
      closeModal();
    }));

    body.appendChild(two);
    openModal(t("btnDrink"), t("onlyAlive"), body, [ mkBtn(t("btnClose"), "btnGhost", closeModal) ]);
  }

  function actMacaron(){
    const save = loadSave(); if(!save) return;
    if(!save.ended || save.macaronActive) return;

    const body = document.createElement("div");
    body.innerHTML = `<div style="font-size:12px;color:rgba(238,242,255,.78);line-height:1.7; white-space:pre-wrap">
${escapeHtml(t("macaronAsk"))}
    </div>`;

    const two = document.createElement("div");
    two.className = "two";

    const use = () => {
      const s = loadSave(); if(!s) return;
      if(!s.ended || s.macaronActive) return;

      const e = calcElapsedMs(s, now());
      const d = ensureDay(s, s.currentDay);
      d.items.macaron++;
      addChoice(s, t("btnMacaron"), "ğŸ¬ " + t("use"));

      s.macaronActive = true;
      s.macaronEndsAtElapsed = e + MACARON_REVIVE_MS;

      s.ended = false;
      s.hunger = clamp(s.hunger - 8 + (Math.random()*6 - 3), 0, 100);
      s.dirt   = clamp(s.dirt   - 6 + (Math.random()*6 - 3), 0, 100);
      s.mood   = clamp(s.mood   + 2 + (Math.random()*6 - 3), 0, 100);

      applyHeart(s, Math.random() < 0.55 ? -2 : 0);

      maybeStartSleep(s, e);

      pushLiveLog(s, t("returned"));
      saveSave(s);
      closeModal();
    };

    two.appendChild(mkChoice("ğŸ¬", t("use"), (LANG==="en"?"Only briefly.":(LANG==="zh"?"åªæ˜¯çŸ­æš‚ã€‚":"ä¸€æ™‚çš„ã«ã€‚")), use));
    two.appendChild(mkChoice("ğŸ•¯ï¸", t("notUse"), (LANG==="en"?"Let it be.":(LANG==="zh"?"å°±è¿™æ ·å§ã€‚":"è¦‹é€ã‚‹ã€‚")), () => {
      const s = loadSave();
      if(s) { addChoice(s, t("btnMacaron"), "ğŸ•¯ï¸ " + t("notUse")); saveSave(s); }
      closeModal();
    }));

    body.appendChild(two);
    openModal(t("btnMacaron"), t("onlyAfter"), body, [ mkBtn(t("btnClose"), "btnGhost", closeModal) ]);
  }

  function exportObservationData(save){
    const days = [];
    for(let i=1;i<=3;i++){
      const d = ensureDay(save, i);
      const cc = d.careCounts || {};
      const lines = (d.choices || []).map(c => `ãƒ»${formatClock(c.t)} ${c.category}ï¼š${c.choice}`).join("\n");

      days.push({
        day: i,
        careCounts: {
          food: cc.food ?? 0,
          out: cc.out ?? 0,
          style: cc.style ?? 0,
          clean: cc.clean ?? 0
        },
        heartChange: d.heartChange ?? 0,
        sitterMs: d.sitterMs ?? 0,
        items: d.items || {drink:0, macaron:0},
        choicesText: lines,
        heartStart: d.heartStart ?? save.heart,
        heartEnd: d.heartEnd ?? save.heart
      });
    }
    return {
      version: 1,
      playerId: save.playerId,
      petName: save.petName || "",
      startedAt: save.startedAt,
      endedAt: save.endedAt || null,
      days
    };
  }

  function toBase64Url(str){
    const b64 = btoa(unescape(encodeURIComponent(str)));
    return b64.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");
  }
  function fromBase64Url(b64url){
    const b64 = b64url.replace(/-/g,"+").replace(/_/g,"/");
    const pad = b64.length % 4 ? "=".repeat(4 - (b64.length % 4)) : "";
    const s = atob(b64 + pad);
    return decodeURIComponent(escape(s));
  }

  function makeShareUrl(save){
    const exp = exportObservationData(save);
    const data = toBase64Url(JSON.stringify(exp));
    const u = new URL(location.href);
    u.searchParams.set("observe","1");
    u.hash = "data=" + data;
    return u.toString();
  }

  async function copyText(text){
    try{
      await navigator.clipboard.writeText(text);
      return true;
    }catch(_){
      const ta = document.createElement("textarea");
      ta.value = text;
      document.body.appendChild(ta);
      ta.select();
      try{
        document.execCommand("copy");
        document.body.removeChild(ta);
        return true;
      }catch(__){
        document.body.removeChild(ta);
        return false;
      }
    }
  }

  function showShare(save){
    const shareUrl = makeShareUrl(save);
    const body = document.createElement("div");
    body.innerHTML = `<div style="font-size:12px;color:rgba(238,242,255,.78);line-height:1.7; white-space:pre-wrap;">
${escapeHtml(t("shareText"))}
    </div>`;
    const box = document.createElement("div");
    box.style.marginTop = "10px";
    box.style.border = "1px solid rgba(255,255,255,.14)";
    box.style.background = "rgba(255,255,255,.04)";
    box.style.borderRadius = "14px";
    box.style.padding = "10px";
    box.style.fontSize = "12px";
    box.style.color = "rgba(238,242,255,.9)";
    box.style.wordBreak = "break-all";
    box.textContent = shareUrl;
    body.appendChild(box);

    const bCopy = mkBtn(t("btnCopy"), "", async () => {
      const ok = await copyText(shareUrl);
      const s = loadSave();
      if(s){
        pushLiveLog(s, ok ? t("shareCopied") : t("shareShown"));
        saveSave(s);
      }
      closeModal();
    });

    openModal(t("shareTitle"), t("shareHint"), body, [
      mkBtn(t("btnClose"), "btnGhost", closeModal),
      bCopy
    ]);
  }

  function drawHeartChart(exp){
    const canvas = ui.heartChart;
    const ctx = canvas.getContext("2d");

    const dpr = Math.max(1, Math.floor(window.devicePixelRatio || 1));
    const cssW = canvas.clientWidth || 900;
    const cssH = 160;
    canvas.width = Math.floor(cssW * dpr);
    canvas.height = Math.floor(cssH * dpr);
    ctx.setTransform(dpr,0,0,dpr,0,0);

    const w = cssW, h = cssH;
    ctx.clearRect(0,0,w,h);

    const padL = 34, padR = 12, padT = 12, padB = 22;

    ctx.lineWidth = 1;
    ctx.strokeStyle = "rgba(255,255,255,.14)";
    ctx.beginPath();
    ctx.moveTo(padL, padT);
    ctx.lineTo(padL, h - padB);
    ctx.lineTo(w - padR, h - padB);
    ctx.stroke();

    ctx.fillStyle = "rgba(238,242,255,.65)";
    ctx.font = "12px system-ui, -apple-system, sans-serif";
    ctx.fillText("100", 6, padT + 10);
    ctx.fillText("0", 14, h - padB + 4);

    const pts = exp.days.map((d, i) => ({ x:i, y: clamp(d.heartEnd ?? 50, 0, 100) }));
    const xSpan = Math.max(1, pts.length - 1);
    const plotW = (w - padL - padR);
    const plotH = (h - padT - padB);

    function pxX(x){ return padL + (x / xSpan) * plotW; }
    function pxY(y){ return padT + (1 - y/100) * plotH; }

    ctx.strokeStyle = "rgba(196,181,253,.92)";
    ctx.lineWidth = 2;
    ctx.beginPath();
    pts.forEach((p, i) => {
      const x = pxX(p.x);
      const y = pxY(p.y);
      if(i === 0) ctx.moveTo(x,y);
      else ctx.lineTo(x,y);
    });
    ctx.stroke();

    ctx.fillStyle = "rgba(147,197,253,.92)";
    pts.forEach(p => {
      const x = pxX(p.x);
      const y = pxY(p.y);
      ctx.beginPath();
      ctx.arc(x,y, 3.5, 0, Math.PI*2);
      ctx.fill();
    });

    ctx.fillStyle = "rgba(238,242,255,.72)";
    exp.days.forEach((d,i) => {
      const x = pxX(i);
      ctx.fillText("D" + d.day, x - 8, h - 6);
    });
  }

  function showObserve(exp, fromUrl){
    ui.screenGame.classList.remove("show");
    ui.screenObserve.classList.add("show");

    const start = new Date(exp.startedAt);
    const end = exp.endedAt ? new Date(exp.endedAt) : null;

    const nm = normalizeName(exp.petName) ? `ï¼ˆ${exp.petName}ï¼‰` : "";
    ui.obsTitle.textContent = `Observer ID: ${exp.playerId.slice(0,8)} ${nm}`;
    ui.obsSub.textContent = end
      ? `${start.toLocaleString()} ã€œ ${end.toLocaleString()}`
      : `${start.toLocaleString()} ã€œ (running)`;

    ui.obsDays.innerHTML = "";
    exp.days.forEach(d => {
      const card = document.createElement("div");
      card.className = "dayCard";
      const sitterMin = Math.round((d.sitterMs || 0) / 60000);
      const c = d.careCounts || {food:0,out:0,style:0,clean:0};
      const it = d.items || {drink:0,macaron:0};

      card.innerHTML = `
        <div class="dh">
          <b>Day ${d.day}</b>
          <small> </small>
        </div>
        <div class="kvs">
          <div><span>${escapeHtml(t("btnFood"))}</span> ${c.food}</div>
          <div><span>${escapeHtml(t("btnOut"))}</span> ${c.out}</div>
          <div><span>${escapeHtml(t("btnStyle"))}</span> ${c.style}</div>
          <div><span>${escapeHtml(t("btnClean"))}</span> ${c.clean}</div>
          <div><span>Heart Î”</span> ${d.heartChange}</div>
          <div><span>${escapeHtml(t("sitter"))}</span> ${sitterMin} min</div>
          <div><span>${escapeHtml(t("btnDrink"))}</span> ${it.drink}</div>
          <div><span>${escapeHtml(t("btnMacaron"))}</span> ${it.macaron}</div>
        </div>
        <div class="choices">${escapeHtml(d.choicesText || "ï¼ˆno logsï¼‰")}</div>
      `;
      ui.obsDays.appendChild(card);
    });

    drawHeartChart(exp);
    ui.btnBackToGame.textContent = fromUrl ? t("btnClose") : t("btnBack");
  }

  function enterObserveFromUrl(){
    const u = new URL(location.href);
    const observe = u.searchParams.get("observe") === "1";
    if(!observe) return false;

    let data = "";
    if(location.hash && location.hash.startsWith("#data=")){
      data = location.hash.slice(6);
    }
    if(!data){
      const body = document.createElement("div");
      body.innerHTML = `<div style="font-size:12px;color:rgba(238,242,255,.78);line-height:1.8">
        No observer data found. Please open the shared URL as-is.
      </div>`;
      openModal("Observer", " ", body, [mkBtn(t("btnClose"), "btnGhost", closeModal)]);
      return true;
    }

    try{
      const json = fromBase64Url(data);
      const exp = JSON.parse(json);
      if(!exp || exp.version !== 1) throw new Error("bad");
      showObserve(exp, true);
      return true;
    }catch(_){
      const body = document.createElement("div");
      body.innerHTML = `<div style="font-size:12px;color:rgba(238,242,255,.78);line-height:1.8">
        Failed to load observer data. The URL might be truncated.
      </div>`;
      openModal("Observer", " ", body, [mkBtn(t("btnClose"), "btnGhost", closeModal)]);
      return true;
    }
  }

  function confirmReset(){
    const body = document.createElement("div");
    body.innerHTML = `<div style="font-size:12px;color:rgba(238,242,255,.78);line-height:1.8; white-space:pre-wrap;">
${escapeHtml(t("resetText"))}
    </div>`;
    const two = document.createElement("div");
    two.className = "two";

    const keep = () => {
      const s = loadSave();
      if(s) archiveRun(s);
      const n = createNewSave();
      saveSave(n);
      pushLiveLog(n, t("logStarted"));
      saveSave(n);
      closeModal();
    };
    const wipe = () => {
      localStorage.removeItem(SAVE_KEY);
      const n = createNewSave();
      saveSave(n);
      pushLiveLog(n, t("logStarted"));
      saveSave(n);
      closeModal();
    };

    two.appendChild(mkChoice("ğŸ—‚ï¸", t("resetKeep"), t("resetKeepSub"), keep));
    two.appendChild(mkChoice("ğŸ§½", t("resetWipe"), t("resetWipeSub"), wipe));
    body.appendChild(two);

    openModal(t("resetTitle"), " ", body, [ mkBtn(t("resetCancel"), "btnGhost", closeModal) ]);
  }

  function showLogs(save){
    const exp = exportObservationData(save);
    showObserve(exp, false);
  }

  function markMissing(src){
    const msg = t("missAsset").replace("{src}", src);
    ui.stageNote.textContent = msg;
  }

  function render(save){
    const elapsed = calcElapsedMs(save, now());
    const pet = normalizeName(save.petName) ? save.petName : "ï¼Ÿï¼Ÿï¼Ÿ";

    ui.heartFill.style.width = clamp(save.heart, 0, 100) + "%";
    ui.sitterToggle.dataset.on = save.pausedSince ? "true" : "false";

    const letterReady = (!save.hatched && !save.ended && elapsed >= LETTER_DELAY_MS);
    if(letterReady){
      showLetterSlot();
    }else{
      hideLetterSlot();
      closeLetter();
    }

    if(!save.hatched){
      ui.macaronArea.style.display = "grid";
      ui.charArea.style.display = "none";
      ui.stageHint.textContent = save.pausedSince ? t("timeStopped") : t("hatchingSoon");
      ui.stageNote.textContent = t("waitNote");
      ui.macaronArea.classList.toggle("hatchLift", !!save.hatchAnim);
    }else{
      ui.macaronArea.style.display = "none";
      ui.charArea.style.display = "grid";

      const sleeping = isSleeping(save, elapsed);

      ui.stageHint.textContent = save.pausedSince ? t("timeStopped") : `${t("thisPet")}${pet}`;
      ui.stageNote.textContent = sleeping ? t("sleepNote") : " ";

      ui.charArea.classList.remove("lively","low","cry","sleep");
      if(sleeping){
        ui.charArea.classList.add("sleep");
      }else{
        const sc = stateClass(save);
        if(sc) ui.charArea.classList.add(sc);
      }
    }

    ui.poop1.classList.toggle("on", save.poop >= 1);
    ui.poop2.classList.toggle("on", save.poop >= 2);
    ui.poop3.classList.toggle("on", save.poop >= 3);

    const interact = canInteract(save, elapsed);
    setInteractable(interact);

    ui.btnMacaron.disabled = !(save.ended && !save.macaronActive);

    ui.thanksOverlay.classList.toggle("show", save.ended && !save.macaronActive);
    ui.subline.textContent = (save.ended && !save.macaronActive) ? t("subEnded") : t("subRunning");

    ui.liveLog.innerHTML = "";
    (save.live || []).slice(0, 14).forEach(it => {
      const div = document.createElement("div");
      div.className = "logItem";
      div.innerHTML = `<b>${escapeHtml(it.text)}</b><div class="t">${formatClock(it.t)}</div>`;
      ui.liveLog.appendChild(div);
    });

    applyVisualImages(save);
  }

  function boot(){
    if(enterObserveFromUrl()) return;

    let save = loadSave();
    if(!save){
      save = createNewSave();
      saveSave(save);
      pushLiveLog(save, t("logStarted"));
      saveSave(save);
    }

    ui.langSel.value = LANG;
    ui.langSel.addEventListener("change", () => setLang(ui.langSel.value));
    applyLangToUI();

    ui.letterBtn.addEventListener("click", openLetter);
    ui.letterClose.addEventListener("click", closeLetter);
    ui.letterX.addEventListener("click", closeLetter);
    ui.letterModal.addEventListener("click", (e) => {
      if(e.target === ui.letterModal) closeLetter();
    });

    ui.macaronImg.addEventListener("error", () => markMissing(ui.macaronImg.src));
    ui.charImg.addEventListener("error", () => {
      const used1 = ui.charImg.getAttribute("data-fallback-used") === "1";
      const used2 = ui.charImg.getAttribute("data-fallback2-used") === "1";
      const fb1 = ui.charImg.getAttribute("data-fallback") || "";
      const fb2 = ui.charImg.getAttribute("data-fallback2") || "";
      if(!used1 && fb1){
        ui.charImg.setAttribute("data-fallback-used","1");
        ui.charImg.src = fb1;
        return;
      }
      if(!used2 && fb2){
        ui.charImg.setAttribute("data-fallback2-used","1");
        ui.charImg.src = fb2;
        return;
      }
      markMissing(ui.charImg.src);
    });

    ui.btnFood.addEventListener("click", actFood);
    ui.btnOut.addEventListener("click", actOut);
    ui.btnStyle.addEventListener("click", actStyle);
    ui.btnClean.addEventListener("click", actClean);
    ui.btnDrink.addEventListener("click", actDrink);
    ui.btnMacaron.addEventListener("click", actMacaron);

    ui.btnShare.addEventListener("click", () => { const s = loadSave(); if(s) showShare(s); });
    ui.btnLogs.addEventListener("click", () => { const s = loadSave(); if(s) showLogs(s); });
    ui.btnName.addEventListener("click", () => openNameModal(false));
    ui.btnReset.addEventListener("click", confirmReset);

    ui.btnBackToGame.addEventListener("click", () => {
      const u = new URL(location.href);
      const observe = u.searchParams.get("observe") === "1";
      if(observe){
        u.searchParams.delete("observe");
        u.hash = "";
        location.href = u.toString();
        return;
      }
      ui.screenObserve.classList.remove("show");
      ui.screenGame.classList.add("show");
    });

    ui.sitterToggle.addEventListener("click", () => {
      const s = loadSave(); if(!s) return;

      if(!s.pausedSince){
        s.pausedSince = now();
        pushLiveLog(s, t("logSitterOn"));
        saveSave(s);
      }else{
        const t1 = now();
        const pausedDur = t1 - s.pausedSince;
        s.totalPausedMs += pausedDur;

        const d = ensureDay(s, s.currentDay);
        d.sitterMs += pausedDur;

        s.pausedSince = null;
        pushLiveLog(s, t("logSitterOff"));
        saveSave(s);
      }
    });

    setInterval(() => {
      const s = loadSave();
      if(!s) return;

      const elapsed = calcElapsedMs(s, now());

      updateDayBoundary(s, elapsed);

      if(!s.pausedSince){
        applyTimeSimulation(s, elapsed);
        maybeHatch(s, elapsed);
        updateMacaronTimer(s, elapsed);
        maybeEnd(s, elapsed);
      }

      s.lastSimElapsed = elapsed;
      saveSave(s);
      render(s);
    }, 650);

    render(save);
  }

  boot();
})();
</script>
</body>
</html>
